import{j as e}from"./ui.DbnHtu_c.js";import{R as s,r}from"./vendor.CJDJhWJD.js";import{D as t,a,b as l,c as n,B as i,u as d,s as c,L as o,A as x,d as m,v as u,e as h}from"./index.BEpZ_ykA.js";import{C as p,a as f,L as j,R as g}from"./Header.CYfUqQ9y.js";import{T as b,a as y,b as w,c as N,d as v,e as k}from"./table.Brv31XsB.js";import{P as C}from"./PageLayout.CIY09S4c.js";import"./utils.CIxrdROE.js";const S=s.memo(({guesses:s,originalGuesses:r,showHeader:t=!0,flashingWord:a})=>0===s.length?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"אין ניחושים קודמים"}):e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(b,{children:[t&&e.jsx(y,{children:e.jsxs(w,{className:"border-b",children:[e.jsx(N,{className:"text-right w-12 py-2 px-2",children:"#"}),e.jsx(N,{className:"text-right w-24 py-2 px-2",children:"מילה"}),e.jsx(N,{className:"text-center w-20 py-2 px-2",children:"קרבה"}),e.jsx(N,{className:"text-center w-28 py-2 px-2",children:"מתחמם?"})]})}),e.jsx(v,{children:s.map((t,l)=>{const n=r.findIndex((e,a)=>e.word===t.word&&e.similarity===t.similarity&&r.slice(0,a).filter(e=>e.word===t.word).length===s.slice(0,l).filter(e=>e.word===t.word).length)+1,i=a===t.word;return e.jsxs(w,{className:`${t.isCorrect?"bg-green-500/20":""} ${i?"animate-pulse bg-yellow-200 dark:bg-yellow-900/50":""}`,children:[e.jsx(k,{className:"w-12 py-1 px-2 text-xs",children:n}),e.jsx(k,{className:"w-24 font-medium py-1 px-2 text-xs truncate",children:t.word}),e.jsx(k,{className:"w-20 text-center py-1 px-2 text-xs",children:`${(100*t.similarity).toFixed(2)}%`}),e.jsx(k,{className:"w-28 text-center py-1 px-2",children:t.rank&&t.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm transition-all duration-200",style:{width:`${Math.min(t.rank/1e3*100,100)}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground font-heebo whitespace-nowrap",children:[t.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-muted-foreground font-heebo",children:"רחוק"})})]},`${t.word}-${l}`)})})]})}));S.displayName="GuessTable";const _=()=>{const[s,d]=r.useState(!1);r.useEffect(()=>{localStorage.getItem("semantle-has-visited")||d(!0)},[]);const c=()=>{localStorage.setItem("semantle-has-visited","true"),d(!1)};return e.jsx(t,{open:s,onOpenChange:c,children:e.jsxs(a,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",dir:"rtl",children:[e.jsx(l,{children:e.jsx(n,{className:"text-xl font-bold text-center font-heebo",children:"נחשו את המילה הסודית"})}),e.jsxs("div",{className:"space-y-4 text-sm leading-relaxed",children:[e.jsx("p",{children:"אפשר לנחש כל מילה. המילה הסודית תהיה תמיד מילה אחת בלבד. אחרי כל ניחוש, המשחק יראה לכם עד כמה המילה קרובה במשמעות למילה הסודית. הקרבה היא לא באיות אלא במשמעות - מה שנקרא קרבה סמנטית."}),e.jsx("p",{children:"המדד הזה מבוסס על מודל בשם Word2Vec, שלמד את השפה מטקסטים של ויקיפדיה. במילים פשוטות: שתי מילים נחשבות קרובות יותר ככל שיותר סביר שתופענה יחד בהקשרים דומים."}),e.jsx("p",{children:"המשחק נותן ציון בין -100 ל־100: 100- זה מאוד רחוק, 100 זו המילה הסודית עצמה."}),e.jsx("p",{children:"בנוסף, תראו אם הניחוש שלכם נמצא בין אלף המילים הקרובות ביותר למילה הסודית - ככה תדעו אם אתם בכיוון."}),e.jsx("p",{children:"המילה הסודית יכולה להיות מכל חלק דיבר (שם עצם, פועל, תואר וכו'), אבל תמיד תהיה מילה אחת בלבד."}),e.jsx("p",{children:"בניגוד ל־Wordle, כאן לא מגבילים אתכם לשישה ניחושים - לרוב תצטרכו הרבה ניחושים כדי להגיע למטרה. המשחק מתעדכן בכל יום עם המילה שהייתה אתמול במשחק המקורי."}),e.jsxs("div",{className:"border-t pt-4 mt-6",children:[e.jsx("h3",{className:"font-bold mb-2 font-heebo",children:"מה שונה ב־סמנטעל +"}),e.jsx("p",{children:"בדף הראשי תוכלו לשחק בכל יום במילה שהופיעה אתמול במשחק המקורי."}),e.jsx("p",{className:"mt-2",children:'דרך דף "היסטוריה" אפשר לגשת לכל אחת מהמילים מהעבר ולשחק אותן מתי שתרצו - בלי לחץ של זמן.'})]}),e.jsx("p",{className:"font-bold text-center font-heebo",children:"בהצלחה!"})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(i,{onClick:c,className:"px-8",children:"בואו נתחיל!"})})]})})},$=e=>{if(!e||e<=0)return"0%";return`${Math.min(e/1e3*100,100)}%`},D=s.memo(()=>{const{gameState:s,currentWord:t,makeGuess:a,resetGame:l,isLoading:n}=d(),[h,j]=r.useState(""),[g,C]=r.useState(null),[D,E]=r.useState(!1);r.useRef(null),r.useRef(null);const T=r.useRef(!1),[R,M]=r.useState(""),[L,W]=r.useState(null),[F,G]=r.useState(null),[I,H]=r.useState(!1),[O,P]=r.useState(!1),V=r.useRef(null),[A,B]=r.useState(null),q=r.useRef(null),[z,U]=r.useState(!1),J=r.useRef(null),K=r.useRef(null),Q=r.useCallback(async()=>{if(s.wordDate){H(!0);try{const{data:r,error:t}=await c.from("daily_sample_ranks").select("*").eq("word_date",s.wordDate).single();if(t&&"PGRST116"!==t.code)throw new Error("שגיאה בטעינת נתונים מהמאגר");if(r)G({1:r.rank_1_score,990:r.rank_990_score,999:r.rank_999_score});else{const r=s.wordDate.split("-");if(3!==r.length)throw new Error("פורמט תאריך לא תקין");const t=`${r[2]}/${r[1]}/${r[0]}`,a=await fetch(`https://combined-he-w2v-api.onrender.com/sample-ranks?date=${encodeURIComponent(t)}`);if(!a.ok)throw new Error(`שגיאה בקבלת נתונים מהשרת: ${a.status}`);const l=await a.json();if(!l.samples||"object"!=typeof l.samples)throw new Error("פורמט תגובה לא תקין מהשרת");G(l.samples);try{await c.from("daily_sample_ranks").insert({word_date:s.wordDate,rank_1_score:l.samples[1],rank_990_score:l.samples[990],rank_999_score:l.samples[999]})}catch(e){console.warn("לא ניתן לשמור במאגר:",e)}}}catch(r){console.error("שגיאה בטעינת נתוני דירוג:",r)}finally{H(!1)}}},[s.wordDate]);r.useEffect(()=>{Q()},[Q]),r.useEffect(()=>()=>{q.current&&clearTimeout(q.current),V.current&&clearTimeout(V.current)},[]),r.useEffect(()=>{z&&!s.isComplete&&J.current&&(J.current.focus(),U(!1))},[z,s.isComplete]);const X=r.useMemo(()=>new Date(s.wordDate).toLocaleDateString("he-IL"),[s.wordDate]);if(r.useEffect(()=>{n||s.isComplete||!J.current||J.current.focus()},[n,s.isComplete]),n)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-xl",children:"טוען משחק..."})});const Y=A?s.guesses.find(e=>e.word===A):null,Z=Y||s.guesses[s.guesses.length-1],ee=Y?s.guesses.findIndex(e=>e.word===A)+1:s.guesses.length,se=(s.isComplete?s.guesses:s.guesses.slice(0,-1)).sort((e,s)=>s.similarity-e.similarity);return e.jsxs("div",{className:"space-y-4 max-w-3xl mx-auto min-h-screen px-2 sm:px-4 pt-4 pb-20 sm:pb-24",style:{overflowAnchor:"none"},children:[e.jsx(_,{}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold font-heebo",children:"סמנטעל +"}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["משחק מיום ",X]})]}),s.isComplete?e.jsx(p,{className:"bg-background dark:bg-slate-800 border-primary-200 dark:border-slate-700",children:e.jsxs(f,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400 text-2xl font-bold mb-4",children:"כל הכבוד! מצאת את המילה!"}),e.jsxs("div",{className:"text-xl mb-4",children:["המילה היא: ",e.jsx("span",{className:"font-bold text-primary-500 dark:text-primary-400",children:t})]}),e.jsxs("div",{className:"text-muted-foreground mb-6",children:["מספר ניחושים: ",s.guesses.length]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-center",children:[e.jsx(i,{onClick:l,className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 w-full sm:w-auto",children:"שחק שוב"}),e.jsx(o,{to:"/history",className:"block w-full sm:w-auto",children:e.jsx(i,{variant:"outline",className:"w-full sm:w-auto",children:"משחק מיום אחר"})})]}),e.jsxs("div",{className:"mt-8 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-medium font-heebo mb-4",children:"נסה מילים נוספות"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"נסה מילים אחרות לראות כמה הן קרובות למילה"}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),!R.trim())return;const r=R.replace(/'/g,""),t=u(r);if(t.isValid){C(null),E(!0);try{const{data:e,error:t}=await c.functions.invoke("calculate-similarity",{body:{guess:r,date:s.wordDate}});if(t)throw new Error("שגיאה בחישוב הדמיון");if(e.error)throw e.error.includes("Word not found in vocabulary")||e.error.includes("not found")||e.error.includes("לא נמצא")||e.error.includes("לא נמצאה במאגר")?new Error(`אני לא מכיר את המילה ${r}`):new Error(e.error);W({word:r,similarity:e.similarity,rank:e.rank}),M("")}catch(a){const e=a instanceof Error?a.message:"שגיאה בבדיקת דמיון";e.includes("Word not found in vocabulary")||e.includes("not found")||e.includes("לא נמצא")||e.includes("לא נמצאה במאגר")?C(`אני לא מכיר את המילה ${r}`):C(e)}finally{E(!1)}}else C(t.errorMessage||"שגיאה בבדיקת המילה")},className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"text",value:R,onChange:e=>M(e.target.value),className:"text-lg flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background",placeholder:"נסה מילה...",disabled:D,dir:"rtl"}),e.jsx(i,{type:"submit",className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 px-6 w-full sm:w-auto",disabled:D||!R.trim(),children:"בדוק"})]})}),L&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium font-heebo mb-2",children:"תוצאה:"}),e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{children:[e.jsx(N,{children:"#"}),e.jsx(N,{children:"מילה"}),e.jsx(N,{children:"קרבה"}),e.jsx(N,{children:"מתחמם?"})]})}),e.jsx(v,{children:e.jsxs(w,{children:[e.jsx(k,{children:"-"}),e.jsx(k,{children:L.word}),e.jsx(k,{children:`${(100*L.similarity).toFixed(2)}%`}),e.jsx(k,{children:L.rank&&L.rank>0?e.jsxs("div",{children:[L.rank,"/1000"]}):e.jsx("span",{children:"רחוק"})})]})})]})})]})]})]})}):e.jsxs(e.Fragment,{children:[I&&e.jsx("div",{className:"text-center text-sm p-3",children:"טוען פרטי משחק..."}),F&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground bg-muted/30 rounded-md p-3 mb-4 font-heebo",children:["ציון הקרבה של המילה הכי קרובה (999/1000) הוא ",e.jsx("strong",{children:(100*F[999]).toFixed(2)}),", ציון הקרבה של המילה העשירית הכי קרובה (990/1000) הוא ",e.jsx("strong",{children:(100*F[990]).toFixed(2)}),", וציון הקרבה של המילה האלף הכי קרובה (1/1000) הוא ",e.jsx("strong",{children:(100*F[1]).toFixed(2)}),"."]}),e.jsxs("div",{className:"space-y-4",children:[O&&e.jsx("div",{className:"animate-in fade-in duration-500 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:["לא נתקענו, פשוט לוקח לנו קצת זמן לחשב את הניחוש הראשון לפעמים :)",e.jsx("br",{}),"אל דאגה, מהניחוש הבא הכול יזרום הרבה יותר מהר"]})]})}),e.jsxs("form",{onSubmit:async e=>{if(e&&e.preventDefault(),!h.trim()||D)return;const r=h.replace(/'/g,""),t=u(r);if(!t.isValid)return void C(t.errorMessage||"שגיאה בבדיקת המילה");C(null);const l=r.trim();if(s.guesses.find(e=>e.word===l))return j(""),B(l),q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{B(null)},2e3),void U(!0);j(""),T.current=!0,E(!0),V.current=setTimeout(()=>{P(!0)},8e3);try{await a(l)}catch(n){const e=n instanceof Error?n.message:"שגיאה בניחוש המילה";e.includes("not found")||e.includes("לא נמצא")||e.includes("Word not found in vocabulary")||e.includes("לא נמצאה במאגר")?C(`אני לא מכיר את המילה ${l}`):C(e)}finally{V.current&&(clearTimeout(V.current),V.current=null),P(!1),T.current=!1,E(!1),U(!0)}},className:"flex flex-row gap-2",autoComplete:"off",style:{minHeight:"50px"},children:[e.jsx("input",{ref:J,type:"search",value:h,onChange:e=>j(e.target.value),placeholder:"נחש מילה...",disabled:!1,dir:"rtl",autoComplete:"off",autoCorrect:"on",autoCapitalize:"none",inputMode:"text",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 text-lg"}),e.jsx(i,{type:"submit",className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 px-4 py-2 text-sm font-medium whitespace-nowrap flex items-center justify-center min-w-[70px] h-10",disabled:!h.trim(),onMouseDown:e=>{e.preventDefault()},onTouchStart:e=>{e.preventDefault()},children:D?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):"נחש"})]}),g&&e.jsx(x,{variant:"destructive",children:e.jsx(m,{children:g})})]})]}),Z&&!s.isComplete&&e.jsxs("div",{className:"space-y-2",ref:K,children:[e.jsx("h3",{className:"text-lg font-bold font-heebo",children:A?"ניחוש קודם":"הניחוש האחרון"}),e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"border-b",children:[e.jsx(N,{className:"text-right w-12 py-2 px-2",children:"#"}),e.jsx(N,{className:"text-right w-24 py-2 px-2",children:"מילה"}),e.jsx(N,{className:"text-center w-20 py-2 px-2",children:"קרבה"}),e.jsx(N,{className:"text-center w-28 py-2 px-2",children:"מתחמם?"})]})}),e.jsx(v,{children:e.jsxs(w,{className:"bg-primary-100 dark:bg-primary-900/30 border-primary-200 dark:border-primary-700",children:[e.jsx(k,{className:"w-12 py-1 px-2 text-xs font-medium text-primary-700 dark:text-primary-300",children:ee}),e.jsx(k,{className:"w-24 font-medium py-1 px-2 text-xs truncate text-primary-700 dark:text-primary-300",children:Z.word}),e.jsx(k,{className:"w-20 text-center py-1 px-2 text-xs text-primary-700 dark:text-primary-300",children:`${(100*Z.similarity).toFixed(2)}%`}),e.jsx(k,{className:"w-28 text-center py-1 px-2",children:Z.rank&&Z.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm min-w-[2px]",style:{width:$(Z.rank)}})}),e.jsxs("span",{className:"text-xs text-primary-700 dark:text-primary-300 font-heebo whitespace-nowrap",children:[Z.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-primary-700 dark:text-primary-300 font-heebo",children:"רחוק"})})]})})]})})]}),se.length>0&&e.jsx("div",{className:Z&&!s.isComplete?"mt-1":"space-y-2",children:e.jsx(S,{guesses:se,originalGuesses:s.guesses,showHeader:!Z||s.isComplete,flashingWord:A})}),0===s.guesses.length&&!s.isComplete&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"עדיין אין ניחושים. התחל לנחש!"})]})});D.displayName="GameBoard";const E=({isOpen:s,onClose:i})=>{const[d,c]=r.useState(!0),o=()=>{c(!d)};return e.jsx(t,{open:s,onOpenChange:i,children:e.jsxs(a,{className:"sm:max-w-md",children:[e.jsx(l,{children:e.jsx(n,{className:"text-center",children:d?"התחברות":"הרשמה"})}),e.jsx("div",{className:"space-y-4",children:d?e.jsx(j,{onToggleMode:o}):e.jsx(g,{onToggleMode:o})})]})})},T=()=>{const{isLoading:s}=d(),{isLoading:t}=h(),[a,l]=r.useState(!1),[n,i]=r.useState(!1);return r.useEffect(()=>{l(!0)},[]),!a||t?e.jsx(C,{children:e.jsx("div",{className:"flex flex-col justify-center items-center h-64",children:e.jsx("div",{className:"text-xl text-primary-500 dark:text-primary-400 mb-4",children:"טוען..."})})}):e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[s?e.jsx("div",{className:"flex flex-col justify-center items-center h-64",children:e.jsx("div",{className:"text-xl text-primary-500 dark:text-primary-400 mb-4",children:"טוען משחק..."})}):e.jsx(D,{}),e.jsx(E,{isOpen:n,onClose:()=>i(!1)})]})})};export{T as default};
