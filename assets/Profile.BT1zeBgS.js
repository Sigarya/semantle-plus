import{j as e}from"./ui.DDQN6UUz.js";import{r as s}from"./vendor.CJDJhWJD.js";import{g as r,j as a,C as t,h as d,i,f as l,I as n,B as c,s as m,k as o}from"./index.G7n8Q-pX.js";import{P as x}from"./PageLayout.D8LsmbH_.js";import"./utils.CIxrdROE.js";const u=()=>{const{currentUser:o,refreshUser:x}=r(),{toast:u}=a(),[p,g]=s.useState(o?.username||""),[h,j]=s.useState(""),[b,v]=s.useState(""),[f,N]=s.useState(""),[y,k]=s.useState(!1),[w,S]=s.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(t,{className:"bg-background dark:bg-slate-800 border-primary-200 dark:border-slate-700",children:[e.jsx(d,{children:e.jsx(i,{className:"text-xl",children:"עדכון שם משתמש"})}),e.jsx(l,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),p.trim()&&p!==o?.username){k(!0);try{const{error:e}=await m.from("profiles").update({username:p}).eq("id",o?.id);if(e)throw e;await x(),u({title:"שם המשתמש עודכן",description:"שם המשתמש החדש נשמר בהצלחה"})}catch(s){console.error("Error updating username:",s),u({variant:"destructive",title:"שגיאה",description:s instanceof Error?s.message:"אירעה שגיאה בעדכון שם המשתמש"})}finally{k(!1)}}else u({variant:"destructive",title:"שגיאה",description:"אנא הזן שם משתמש חדש"})},className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"username",className:"text-sm font-medium",children:"שם משתמש חדש"}),e.jsx(n,{id:"username",type:"text",value:p,onChange:e=>g(e.target.value),placeholder:"הזן שם משתמש חדש",dir:"rtl"})]}),e.jsx(c,{type:"submit",className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600",disabled:y||!p.trim()||p===o?.username,children:y?"מעדכן...":"עדכן שם משתמש"})]})})]}),e.jsxs(t,{className:"bg-background dark:bg-slate-800 border-primary-200 dark:border-slate-700",children:[e.jsx(d,{children:e.jsx(i,{className:"text-xl",children:"עדכון סיסמה"})}),e.jsx(l,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),h&&b&&f)if(b===f)if(b.length<6)u({variant:"destructive",title:"שגיאה",description:"הסיסמה חייבת להכיל לפחות 6 תווים"});else{S(!0);try{const{error:e}=await m.auth.updateUser({password:b});if(e)throw e;u({title:"הסיסמה עודכנה",description:"הסיסמה החדשה נשמרה בהצלחה"}),j(""),v(""),N("")}catch(s){console.error("Error updating password:",s),u({variant:"destructive",title:"שגיאה",description:s instanceof Error?s.message:"אירעה שגיאה בעדכון הסיסמה"})}finally{S(!1)}}else u({variant:"destructive",title:"שגיאה",description:"הסיסמאות החדשות אינן תואמות"});else u({variant:"destructive",title:"שגיאה",description:"אנא מלא את כל השדות"})},className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"new-password",className:"text-sm font-medium",children:"סיסמה חדשה"}),e.jsx(n,{id:"new-password",type:"password",value:b,onChange:e=>v(e.target.value),placeholder:"הזן סיסמה חדשה",dir:"rtl"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"confirm-password",className:"text-sm font-medium",children:"אימות סיסמה חדשה"}),e.jsx(n,{id:"confirm-password",type:"password",value:f,onChange:e=>N(e.target.value),placeholder:"הזן שוב את הסיסמה החדשה",dir:"rtl"})]}),e.jsx(c,{type:"submit",className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600",disabled:w||!b||!f||b!==f,children:w?"מעדכן...":"עדכן סיסמה"})]})})]})]})},p=()=>{const{currentUser:a}=r(),n=o();return s.useEffect(()=>{a||n("/")},[a,n]),a?e.jsx(x,{title:"הפרופיל שלי",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs(t,{className:"bg-background dark:bg-slate-800 border-primary-200 dark:border-slate-700 mb-6",children:[e.jsx(d,{children:e.jsx(i,{className:"text-xl",children:"פרטי משתמש"})}),e.jsx(l,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-lg",children:[e.jsx("span",{className:"text-muted-foreground",children:"שם משתמש:"}),e.jsx("span",{children:a.username}),e.jsx("span",{className:"text-muted-foreground",children:"סוג חשבון:"}),e.jsx("span",{children:a.isAdmin?"מנהל":"שחקן"})]})})]}),e.jsx(u,{}),e.jsxs(t,{className:"bg-background dark:bg-slate-800 border-primary-200 dark:border-slate-700 mt-6",children:[e.jsx(d,{children:e.jsx(i,{className:"text-xl",children:"סטטיסטיקות"})}),e.jsx(l,{children:a.stats?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-primary-100 dark:bg-primary-900/20 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:a.stats.gamesWon}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"משחקים שנוצחו"})]}),e.jsxs("div",{className:"bg-primary-100 dark:bg-primary-900/20 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:a.stats.totalGames}),e.jsx("div",{className:"text-sm text-muted-foreground",children:'סה"כ משחקים'})]}),e.jsxs("div",{className:"bg-primary-100 dark:bg-primary-900/20 p-4 rounded-lg text-center",children:[e.jsxs("div",{className:"text-3xl font-bold",children:[a.stats.totalGames>0?Math.round(a.stats.gamesWon/a.stats.totalGames*100):0,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"אחוז ניצחונות"})]}),e.jsxs("div",{className:"bg-primary-100 dark:bg-primary-900/20 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:a.stats.bestGuessCount||"-"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"ניחושים מינימלי"})]}),e.jsxs("div",{className:"bg-primary-100 dark:bg-primary-900/20 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:a.stats.averageGuessCount.toFixed(1)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"ממוצע ניחושים"})]}),e.jsxs("div",{className:"bg-primary-100 dark:bg-primary-900/20 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:a.stats.winStreak}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"רצף ניצחונות"})]})]}):e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"אין נתונים זמינים. שחק משחק כדי לראות את הסטטיסטיקות שלך!"})})]})]})}):null};export{p as default};
