import{j as e}from"./ui.DDQN6UUz.js";import{r}from"./vendor.CJDJhWJD.js";import{h as s,s as t,u as a,f as i,i as n,j as d,B as o}from"./index.Vc1oMdpK.js";import{C as l,b as c,c as m,a as x,P as p}from"./PageLayout.CZieBVrS.js";import{T as h,a as j,b as g,c as u,d as f,e as b}from"./table.nI6HvDPQ.js";import"./utils.CIxrdROE.js";const y=()=>{const{dailyWords:p,loadHistoricalGame:y}=a(),{isGameCompleted:w}=(()=>{const{currentUser:e}=s(),[a,i]=r.useState([]),[n,d]=r.useState(!1),o=async()=>{if(e){d(!0);try{const{data:r,error:s}=await t.from("daily_scores").select("word_date, guesses_count, completion_time").eq("user_id",e.id).order("word_date",{ascending:!1});s?(console.error("Error fetching user completions:",s),i([])):i(r||[])}catch(r){console.error("Error fetching user completions:",r),i([])}finally{d(!1)}}else i([])};return r.useEffect(()=>{o()},[e]),{completions:a,isLoading:n,isGameCompleted:e=>a.some(r=>r.word_date===e),getCompletionInfo:e=>a.find(r=>r.word_date===e)||null,refreshCompletions:o}})(),{toast:N}=i(),k=n(),[v,_]=r.useState(!1),S=[...p].sort((e,r)=>new Date(r.date).getTime()-new Date(e.date).getTime());return e.jsxs(l,{className:"bg-background dark:bg-slate-800 border-primary-200 dark:border-slate-700",children:[e.jsx(c,{children:e.jsx(m,{className:"text-xl font-heebo",children:"היסטורית משחקים"})}),e.jsx(x,{children:0===S.length?e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:"אין משחקים קודמים זמינים כרגע"}):e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs(g,{children:[e.jsx(u,{className:"text-right",children:"תאריך"}),e.jsx(u,{className:"text-center",children:"פעולות"})]})}),e.jsx(f,{children:S.map(r=>{const s=new Date(r.date),t=new Date;t.setHours(0,0,0,0);const a=s<t,i=w(r.date);return e.jsxs(g,{children:[e.jsx(b,{children:d(new Date(r.date))}),e.jsx(b,{className:"text-center",children:e.jsxs("div",{className:"flex justify-center",children:[a&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>(async e=>{_(!0);try{await y(e),k("/"),N({title:"משחק היסטורי נטען",description:`המשחק מתאריך ${d(new Date(e))} נטען בהצלחה`})}catch(r){N({variant:"destructive",title:"שגיאה",description:r instanceof Error?r.message:"אירעה שגיאה בטעינת המשחק"})}finally{_(!1)}})(r.date),disabled:v,className:"min-w-[80px] "+(i?"border-green-500 text-green-600 hover:bg-green-50 dark:text-green-400 dark:border-green-400 dark:hover:bg-green-900/20":""),children:v?"טוען...":i?"הושלם 🎉":"שחק"}),!a&&r.date===t.toISOString().split("T")[0]&&e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"משחק נוכחי"}),!a&&r.date!==t.toISOString().split("T")[0]&&e.jsx("span",{className:"text-muted-foreground",children:"טרם זמין"})]})})]},r.date)})})]})})]})},w=()=>e.jsxs(p,{title:"היסטורית משחקים",children:[e.jsx("div",{className:"max-w-3xl mx-auto mb-6 p-4 bg-primary-50 dark:bg-slate-800 rounded-md border border-primary-200 dark:border-slate-700 text-center",children:e.jsxs("p",{className:"text-primary-800 dark:text-primary-300",children:["רוצים לנסות שוב? פספסתם את הסמנטעל אתמול? כאן תוכלו לשחק בגרסאות קודמות של המשחק היומי.",e.jsx("br",{}),"בכל יום קצת אחרי השעה 3:00 יעלה המשחק של אתמול ותוכלו למצוא אותו גם כאן וגם בדף הראשי."]})}),e.jsx(y,{})]});export{w as default};
