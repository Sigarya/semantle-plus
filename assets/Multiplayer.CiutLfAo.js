import{j as e}from"./ui.DDQN6UUz.js";import{r as s}from"./vendor.CJDJhWJD.js";import{n as t,j as r,C as a,h as i,i as n,f as l,B as c,m as o,I as d,c as x,a as m,o as h,p,k as u,u as j}from"./index.G7n8Q-pX.js";import{P as y}from"./PageLayout.D8LsmbH_.js";import{U as g}from"./users.Dzo95ueV.js";import{T as f,a as N,b,c as v,d as k,e as w}from"./table.-EjUMR3o.js";import"./utils.CIxrdROE.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=t("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),M=t("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),_=t("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),L=t("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),S=t("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),D=t("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),R=t("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),F=({onCreateRoom:t,onJoinRoom:x,wordDate:m,isLoading:h})=>{const{toast:p}=r(),[u,j]=s.useState("lobby"),[y,f]=s.useState(""),[N,b]=s.useState(""),v=new Date(m).toLocaleDateString("he-IL");return e.jsxs("div",{className:"space-y-4 max-w-2xl mx-auto",children:["lobby"===u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold font-heebo mb-2",children:"שחק עם חברים"}),e.jsxs("p",{className:"text-muted-foreground",children:["משחק מיום ",v," ",e.jsx("br",{}),"(לבחירת יום אחר יש להיכנס למשחק עם חברים דרך עמוד היסטוריה בתפריט)"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"אין צורך בהרשמה - צרו חדר או הצטרפו למשחק קיים והתחילו לשחק!"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(a,{className:"cursor-pointer transition-all hover:shadow-lg hover:scale-105",onClick:()=>j("create"),children:[e.jsxs(i,{className:"text-center",children:[e.jsx(g,{className:"w-12 h-12 mx-auto mb-2 text-primary-500"}),e.jsx(n,{className:"font-heebo",children:"צור חדר חדש"})]}),e.jsxs(l,{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"צור חדר חדש ושתף את הקוד עם החברים שלך"}),e.jsxs(c,{className:"w-full",children:["צור חדר",e.jsx(C,{className:"w-4 h-4 mr-2"})]})]})]}),e.jsxs(a,{className:"cursor-pointer transition-all hover:shadow-lg hover:scale-105",onClick:()=>j("join"),children:[e.jsxs(i,{className:"text-center",children:[e.jsx(R,{className:"w-12 h-12 mx-auto mb-2 text-primary-500"}),e.jsx(n,{className:"font-heebo",children:"הצטרף לחדר קיים"})]}),e.jsxs(l,{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"הזן קוד חדר שקיבלת מחבר והצטרף למשחק"}),e.jsxs(c,{variant:"outline",className:"w-full",children:["הצטרף לחדר",e.jsx(R,{className:"w-4 h-4 mr-2"})]})]})]})]})]}),"create"===u&&e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(n,{className:"font-heebo text-center",children:"צור חדר חדש"})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"nickname",children:"השם שלך במשחק"}),e.jsx(d,{id:"nickname",value:y,onChange:e=>f(e.target.value),placeholder:"הכנס שם לתצוגה...",maxLength:20,dir:"rtl"})]}),e.jsx("div",{className:"bg-muted p-4 rounded-md",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"לאחר יצירת החדר תקבלו קוד חדר ייחודי שתוכל לשתף עם חברים. כל השחקנים יראו את הניחושים של כולם בזמן אמת!"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:()=>{y.trim()?t(y.trim()):p({title:"שם חסר",description:"יש להכניס שם לתצוגה במשחק",variant:"destructive"})},disabled:h||!y.trim(),className:"flex-1",children:h?"יוצר חדר...":"צור חדר"}),e.jsx(c,{variant:"outline",onClick:()=>j("lobby"),disabled:h,children:"חזור"})]})]})]}),"join"===u&&e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(n,{className:"font-heebo text-center",children:"הצטרף לחדר קיים"})}),e.jsxs(l,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"room-code",children:"קוד החדר"}),e.jsx(d,{id:"room-code",value:N,onChange:e=>b(e.target.value.toUpperCase()),placeholder:"הכנס קוד חדר (למשל: ABC123)",maxLength:6,className:"text-center font-mono text-lg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"join-nickname",children:"השם שלך במשחק"}),e.jsx(d,{id:"join-nickname",value:y,onChange:e=>f(e.target.value),placeholder:"הכנס שם לתצוגה...",maxLength:20,dir:"rtl"})]}),e.jsx("div",{className:"bg-muted p-4 rounded-md",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"הזן את קוד החדר שקיבלת מהחבר שיצר את החדר ואת השם שברצונך שיופיע במשחק."})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{onClick:()=>{y.trim()?N.trim()?x(N.trim().toUpperCase(),y.trim()):p({title:"קוד חדר חסר",description:"יש להכניס קוד חדר תקין",variant:"destructive"}):p({title:"שם חסר",description:"יש להכניס שם לתצוגה במשחק",variant:"destructive"})},disabled:h||!y.trim()||!N.trim(),className:"flex-1",children:h?"מצטרף...":"הצטרף לחדר"}),e.jsx(c,{variant:"outline",onClick:()=>j("lobby"),disabled:h,children:"חזור"})]})]})]})]})},T=m("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function E({className:s,variant:t,...r}){return e.jsx("div",{className:x(T({variant:t}),s),...r})}const H=e=>{if(!e||e<=0)return"0%";return`${Math.min(e/1e3*100,100)}%`},V=({guesses:s})=>e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(f,{children:[e.jsx(N,{children:e.jsxs(b,{children:[e.jsx(v,{className:"text-right w-12 py-2 px-2",children:"#"}),e.jsx(v,{className:"text-right py-2 px-2",children:"מילה"}),e.jsx(v,{className:"text-right py-2 px-2",children:"שחקן"}),e.jsx(v,{className:"text-center w-20 py-2 px-2",children:"קרבה"}),e.jsx(v,{className:"text-center w-28 py-2 px-2",children:"מתחמם?"})]})}),e.jsx(k,{children:s.map(s=>e.jsxs(b,{className:s.is_correct?"bg-green-100 dark:bg-green-900/30":"",children:[e.jsx(w,{className:"text-right py-1 px-2 text-xs",children:s.guess_order}),e.jsx(w,{className:"font-medium text-right py-1 px-2 text-xs",children:s.guess_word}),e.jsx(w,{className:"text-right py-1 px-2 text-xs",children:e.jsx(E,{variant:"outline",className:"font-normal",children:s.player_nickname})}),e.jsx(w,{className:"text-center py-1 px-2 text-xs",children:`${(100*s.similarity).toFixed(2)}%`}),e.jsx(w,{className:"text-center py-1 px-2",children:s.rank&&s.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm min-w-[2px]",style:{width:H(s.rank)}})}),e.jsxs("span",{className:"text-xs text-muted-foreground font-heebo whitespace-nowrap",children:[s.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-muted-foreground font-heebo",children:"רחוק"})})]},s.id))})]})}),$=()=>{const{gameState:t,makeGuess:o,leaveRoom:x}=h(),{toast:m}=r(),[p,u]=s.useState(""),[j,y]=s.useState(!1),[C,R]=s.useState(!1),F=s.useMemo(()=>[...t.guesses].sort((e,s)=>s.similarity-e.similarity),[t.guesses]),T=s.useMemo(()=>0===t.guesses.length?null:t.guesses.reduce((e,s)=>e.guess_order>s.guess_order?e:s),[t.guesses]),$=s.useMemo(()=>t.isComplete?F:F.filter(e=>e.id!==T?.id),[F,T,t.isComplete]),q=s.useCallback(async()=>{const e=t.room?.room_code||"";if(e)try{if(navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)await navigator.clipboard.writeText(e);else{const s=document.createElement("textarea");s.value=e,s.setAttribute("readonly",""),s.style.position="absolute",s.style.left="-9999px",document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s)}R(!0),setTimeout(()=>R(!1),2e3)}catch(s){console.error("Failed to copy room code:",s),window.prompt("Could not copy automatically. Please copy this code:",e)}},[t.room?.room_code]),P=s.useCallback(async e=>{if(e.preventDefault(),p.trim()&&!j){y(!0);try{await o(p.trim()),u("")}catch(s){const e=s instanceof Error?s.message:"שגיאה בניחוש המילה";m({title:"שגיאה",description:e,variant:"destructive"})}finally{y(!1)}}},[p,j,o,m]);return t.room?e.jsxs("div",{className:"max-w-3xl mx-auto p-4 sm:p-6 space-y-4",children:[t.isComplete&&e.jsx(a,{className:"border-green-400 bg-green-50 text-green-800 animate-in fade-in slide-in-from-top-4 duration-500",children:e.jsx(l,{className:"p-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsx(D,{className:"h-10 w-10 text-green-500"}),e.jsxs("div",{children:[e.jsx(n,{className:"text-2xl font-bold",children:"ניצחתם!"}),e.jsx("p",{className:"mt-2 text-green-700",children:"מצאתם את המילה הסודית ביחד, כל הכבוד!"})]}),e.jsx(c,{onClick:x,variant:"outline",className:"mt-2 border-green-300 hover:bg-green-100 text-green-800",children:"עזוב חדר"})]})})}),e.jsx(a,{children:e.jsxs(i,{className:"text-center pb-4",children:[e.jsxs(n,{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"})," חדר מרובה משתתפים"]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-x-4 gap-y-1 text-sm text-muted-foreground mt-2",children:[e.jsxs("span",{children:["שחקנים: ",t.players.length]}),e.jsxs("span",{children:["תאריך: ",new Date(t.room.word_date).toLocaleDateString("he-IL")]}),e.jsxs("span",{className:"flex items-center",children:["קוד:",e.jsxs("button",{onClick:q,className:"inline-flex items-center gap-1 mr-1 hover:bg-muted px-2 py-0.5 rounded transition-colors",title:"לחץ להעתקה",children:[e.jsx(E,{variant:"secondary",className:"cursor-pointer hover:bg-muted-foreground/20",children:t.room.room_code}),C?e.jsx(M,{className:"h-3 w-3 text-green-500"}):e.jsx(_,{className:"h-3 w-3"})]})]})]})]})}),!t.isComplete&&e.jsxs(a,{children:[e.jsx(i,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"})," כאן מנחשים:"]})}),e.jsx(l,{children:e.jsxs("form",{onSubmit:P,className:"flex gap-2",children:[e.jsx(d,{value:p,onChange:e=>u(e.target.value),placeholder:"הקלד מילה...",disabled:j,className:"flex-1",dir:"rtl"}),e.jsx(c,{type:"submit",disabled:j||!p.trim(),className:"min-w-[80px]",children:j?e.jsx(L,{className:"h-4 w-4 animate-spin"}):"נחש"})]})})]}),T&&!t.isComplete&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-bold font-heebo",children:"הניחוש האחרון"}),e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(f,{children:[e.jsx(N,{children:e.jsxs(b,{className:"border-b",children:[e.jsx(v,{className:"text-right w-12 py-2 px-2",children:"#"}),e.jsx(v,{className:"text-right py-2 px-2",children:"מילה"}),e.jsx(v,{className:"text-right py-2 px-2",children:"שחקן"}),e.jsx(v,{className:"text-center w-20 py-2 px-2",children:"קרבה"}),e.jsx(v,{className:"text-center w-28 py-2 px-2",children:"מתחמם?"})]})}),e.jsx(k,{children:e.jsxs(b,{className:"bg-primary-100 dark:bg-primary-900/30 border-primary-200 dark:border-primary-700",children:[e.jsx(w,{className:"w-12 py-1 px-2 text-xs font-medium text-primary-700 dark:text-primary-300",children:T.guess_order}),e.jsx(w,{className:"font-medium py-1 px-2 text-xs truncate text-primary-700 dark:text-primary-300",children:T.guess_word}),e.jsx(w,{className:"py-1 px-2 text-xs text-primary-700 dark:text-primary-300",children:e.jsx(E,{variant:"outline",className:"font-normal border-primary-300 dark:border-primary-700",children:T.player_nickname})}),e.jsx(w,{className:"w-20 text-center py-1 px-2 text-xs text-primary-700 dark:text-primary-300",children:`${(100*T.similarity).toFixed(2)}%`}),e.jsx(w,{className:"w-28 text-center py-1 px-2",children:T.rank&&T.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm min-w-[2px]",style:{width:H(T.rank)}})}),e.jsxs("span",{className:"text-xs text-primary-700 dark:text-primary-300 font-heebo whitespace-nowrap",children:[T.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-primary-700 dark:text-primary-300 font-heebo",children:"רחוק"})})]})})]})})]}),$.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-bold font-heebo",children:t.isComplete?`כל הניחושים (${F.length})`:"ניחושים קודמים"}),e.jsx(V,{guesses:$})]}),0===t.guesses.length&&!t.isComplete&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"עדיין אין ניחושים. תתחילו לנחש!"}),!t.isComplete&&e.jsx("div",{className:"text-center pt-4",children:e.jsx(c,{onClick:x,variant:"outline",children:"יציאה מהחדר"})})]}):e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(L,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"טוען משחק מרובה משתתפים..."})]})})},q=()=>{const[t]=p();u();const{toast:a}=r(),{gameState:i,isLoading:n,createRoom:l,joinRoom:c}=h(),{getCurrentGameDate:o}=j(),[d,x]=s.useState("");s.useEffect(()=>{const e=t.get("date");x(e||o())},[t,o]);return e.jsx(y,{children:e.jsx("div",{className:"space-y-6",children:i.room?e.jsx($,{}):e.jsx(F,{onCreateRoom:async e=>{try{const s=await l(e,d);a({title:"חדר נוצר בהצלחה! 🎉",description:`קוד החדר: ${s}`,duration:5e3})}catch(s){console.error("Error creating room:",s)}},onJoinRoom:async(e,s)=>{try{await c(e,s),a({title:"הצטרפת לחדר! 🎉",description:"המשחק הקבוצתי מתחיל",duration:3e3})}catch(t){console.error("Error joining room:",t)}},wordDate:d,isLoading:n})})})};export{q as default};
