import{j as e}from"./ui.DDQN6UUz.js";import{r as s,R as r}from"./vendor.CJDJhWJD.js";import{c as t,a,D as l,b as n,d as i,e as d,B as o,u as c,s as m,L as x,v as u,f as h}from"./index.B8S3QjmP.js";import{C as p,a as f,L as j,R as g}from"./Header.DKD4Nm_c.js";import{T as b,a as y,b as w,c as v,d as N,e as k}from"./table.CbebjMa5.js";import{P as C}from"./PageLayout.HZJIi3b0.js";import"./utils.CIxrdROE.js";const S=a("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),_=s.forwardRef(({className:s,variant:r,...a},l)=>e.jsx("div",{ref:l,role:"alert",className:t(S({variant:r}),s),...a}));_.displayName="Alert";s.forwardRef(({className:s,...r},a)=>e.jsx("h5",{ref:a,className:t("mb-1 font-medium leading-none tracking-tight",s),...r})).displayName="AlertTitle";const D=s.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:t("text-sm [&_p]:leading-relaxed",s),...r}));D.displayName="AlertDescription";const $=r.memo(({guesses:s,originalGuesses:r,showHeader:t=!0,flashingWord:a})=>0===s.length?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"אין ניחושים קודמים"}):e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(b,{children:[t&&e.jsx(y,{children:e.jsxs(w,{className:"border-b",children:[e.jsx(v,{className:"text-right w-12 py-2 px-2",children:"#"}),e.jsx(v,{className:"text-right w-24 py-2 px-2",children:"מילה"}),e.jsx(v,{className:"text-center w-20 py-2 px-2",children:"קרבה"}),e.jsx(v,{className:"text-center w-28 py-2 px-2",children:"מתחמם?"})]})}),e.jsx(N,{children:s.map((t,l)=>{const n=r.findIndex((e,a)=>e.word===t.word&&e.similarity===t.similarity&&r.slice(0,a).filter(e=>e.word===t.word).length===s.slice(0,l).filter(e=>e.word===t.word).length)+1,i=a===t.word;return e.jsxs(w,{className:`${t.isCorrect?"bg-green-500/20":""} ${i?"animate-pulse bg-yellow-200 dark:bg-yellow-900/50":""}`,children:[e.jsx(k,{className:"w-12 py-1 px-2 text-xs",children:n}),e.jsx(k,{className:"w-24 font-medium py-1 px-2 text-xs truncate",children:t.word}),e.jsx(k,{className:"w-20 text-center py-1 px-2 text-xs",children:`${(100*t.similarity).toFixed(2)}%`}),e.jsx(k,{className:"w-28 text-center py-1 px-2",children:t.rank&&t.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm transition-all duration-200",style:{width:`${Math.min(t.rank/1e3*100,100)}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground font-heebo whitespace-nowrap",children:[t.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-muted-foreground font-heebo",children:"רחוק"})})]},`${t.word}-${l}`)})})]})}));$.displayName="GuessTable";const E=()=>{const[r,t]=s.useState(!1);s.useEffect(()=>{localStorage.getItem("semantle-has-visited")||t(!0)},[]);const a=()=>{localStorage.setItem("semantle-has-visited","true"),t(!1)};return e.jsx(l,{open:r,onOpenChange:a,children:e.jsxs(n,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",dir:"rtl",children:[e.jsx(i,{children:e.jsx(d,{className:"text-xl font-bold text-center font-heebo",children:"נחשו את המילה הסודית"})}),e.jsxs("div",{className:"space-y-4 text-sm leading-relaxed",children:[e.jsx("p",{children:"אפשר לנחש כל מילה. המילה הסודית תהיה תמיד מילה אחת בלבד. אחרי כל ניחוש, המשחק יראה לכם עד כמה המילה קרובה במשמעות למילה הסודית. הקרבה היא לא באיות אלא במשמעות - מה שנקרא קרבה סמנטית."}),e.jsx("p",{children:"המדד הזה מבוסס על מודל בשם Word2Vec, שלמד את השפה מטקסטים של ויקיפדיה. במילים פשוטות: שתי מילים נחשבות קרובות יותר ככל שיותר סביר שתופענה יחד בהקשרים דומים."}),e.jsx("p",{children:"המשחק נותן ציון בין -100 ל־100: 100- זה מאוד רחוק, 100 זו המילה הסודית עצמה."}),e.jsx("p",{children:"בנוסף, תראו אם הניחוש שלכם נמצא בין אלף המילים הקרובות ביותר למילה הסודית - ככה תדעו אם אתם בכיוון."}),e.jsx("p",{children:"המילה הסודית יכולה להיות מכל חלק דיבר (שם עצם, פועל, תואר וכו'), אבל תמיד תהיה מילה אחת בלבד."}),e.jsx("p",{children:"בניגוד ל־Wordle, כאן לא מגבילים אתכם לשישה ניחושים - לרוב תצטרכו הרבה ניחושים כדי להגיע למטרה. המשחק מתעדכן בכל יום עם המילה שהייתה אתמול במשחק המקורי."}),e.jsxs("div",{className:"border-t pt-4 mt-6",children:[e.jsx("h3",{className:"font-bold mb-2 font-heebo",children:"מה שונה ב־סמנטעל +"}),e.jsx("p",{children:"בדף הראשי תוכלו לשחק בכל יום במילה שהופיעה אתמול במשחק המקורי."}),e.jsx("p",{className:"mt-2",children:'דרך דף "היסטוריה" אפשר לגשת לכל אחת מהמילים מהעבר ולשחק אותן מתי שתרצו - בלי לחץ של זמן.'})]}),e.jsx("p",{className:"font-bold text-center font-heebo",children:"בהצלחה!"})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(o,{onClick:a,className:"px-8",children:"בואו נתחיל!"})})]})})},R=e=>{if(!e||e<=0)return"0%";return`${Math.min(e/1e3*100,100)}%`},T=r.memo(()=>{const{gameState:r,currentWord:t,makeGuess:a,resetGame:l,isLoading:n}=c(),[i,d]=s.useState(""),[h,j]=s.useState(null),[g,C]=s.useState(!1);s.useRef(null),s.useRef(null);const S=s.useRef(!1),[T,M]=s.useState(""),[L,W]=s.useState(null),[F,G]=s.useState(null),[I,A]=s.useState(!1),[H,O]=s.useState(!1),V=s.useRef(null),[P,B]=s.useState(null),q=s.useRef(null),[z,U]=s.useState(!1),J=s.useRef(null),K=s.useRef(null),Q=s.useCallback(async()=>{if(r.wordDate){A(!0);try{const{data:s,error:t}=await m.from("daily_sample_ranks").select("*").eq("word_date",r.wordDate).single();if(t&&"PGRST116"!==t.code)throw new Error("שגיאה בטעינת נתונים מהמאגר");if(s)G({1:s.rank_1_score,990:s.rank_990_score,999:s.rank_999_score});else{const s=r.wordDate.split("-");if(3!==s.length)throw new Error("פורמט תאריך לא תקין");const t=`${s[2]}/${s[1]}/${s[0]}`,a=await fetch(`https://combined-he-w2v-api.onrender.com/sample-ranks?date=${encodeURIComponent(t)}`);if(!a.ok)throw new Error(`שגיאה בקבלת נתונים מהשרת: ${a.status}`);const l=await a.json();if(!l.samples||"object"!=typeof l.samples)throw new Error("פורמט תגובה לא תקין מהשרת");G(l.samples);try{await m.from("daily_sample_ranks").insert({word_date:r.wordDate,rank_1_score:l.samples[1],rank_990_score:l.samples[990],rank_999_score:l.samples[999]})}catch(e){console.warn("לא ניתן לשמור במאגר:",e)}}}catch(s){console.error("שגיאה בטעינת נתוני דירוג:",s)}finally{A(!1)}}},[r.wordDate]);s.useEffect(()=>{Q()},[Q]),s.useEffect(()=>()=>{q.current&&clearTimeout(q.current),V.current&&clearTimeout(V.current)},[]),s.useEffect(()=>{z&&!r.isComplete&&J.current&&(J.current.focus(),U(!1))},[z,r.isComplete]);const X=s.useMemo(()=>new Date(r.wordDate).toLocaleDateString("he-IL"),[r.wordDate]);if(s.useEffect(()=>{n||r.isComplete||!J.current||J.current.focus()},[n,r.isComplete]),n)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-xl",children:"טוען משחק..."})});const Y=P?r.guesses.find(e=>e.word===P):null,Z=Y||r.guesses[r.guesses.length-1],ee=Y?r.guesses.findIndex(e=>e.word===P)+1:r.guesses.length,se=(r.isComplete?r.guesses:r.guesses.slice(0,-1)).sort((e,s)=>s.similarity-e.similarity);return e.jsxs("div",{className:"space-y-4 max-w-3xl mx-auto min-h-screen px-2 sm:px-4 pt-4 pb-20 sm:pb-24",style:{overflowAnchor:"none"},children:[e.jsx(E,{}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold font-heebo",children:"סמנטעל +"}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["משחק מיום ",X]})]}),r.isComplete?e.jsx(p,{className:"bg-background dark:bg-slate-800 border-primary-200 dark:border-slate-700",children:e.jsxs(f,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400 text-2xl font-bold mb-4",children:"כל הכבוד! מצאת את המילה!"}),e.jsxs("div",{className:"text-xl mb-4",children:["המילה היא: ",e.jsx("span",{className:"font-bold text-primary-500 dark:text-primary-400",children:t})]}),e.jsxs("div",{className:"text-muted-foreground mb-6",children:["מספר ניחושים: ",r.guesses.length]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-center",children:[e.jsx(o,{onClick:l,className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 w-full sm:w-auto",children:"שחק שוב"}),e.jsx(x,{to:"/history",className:"block w-full sm:w-auto",children:e.jsx(o,{variant:"outline",className:"w-full sm:w-auto",children:"משחק מיום אחר"})})]}),e.jsxs("div",{className:"mt-8 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-medium font-heebo mb-4",children:"נסה מילים נוספות"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"נסה מילים אחרות לראות כמה הן קרובות למילה"}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),!T.trim())return;const s=T.replace(/'/g,""),t=u(s);if(t.isValid){j(null),C(!0);try{const{data:e,error:t}=await m.functions.invoke("calculate-similarity",{body:{guess:s,date:r.wordDate}});if(t)throw new Error("שגיאה בחישוב הדמיון");if(e.error)throw e.error.includes("Word not found in vocabulary")||e.error.includes("not found")||e.error.includes("לא נמצא")||e.error.includes("לא נמצאה במאגר")?new Error(`אני לא מכיר את המילה ${s}`):new Error(e.error);W({word:s,similarity:e.similarity,rank:e.rank}),M("")}catch(a){const e=a instanceof Error?a.message:"שגיאה בבדיקת דמיון";e.includes("Word not found in vocabulary")||e.includes("not found")||e.includes("לא נמצא")||e.includes("לא נמצאה במאגר")?j(`אני לא מכיר את המילה ${s}`):j(e)}finally{C(!1)}}else j(t.errorMessage||"שגיאה בבדיקת המילה")},className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"text",value:T,onChange:e=>M(e.target.value),className:"text-lg flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background",placeholder:"נסה מילה...",disabled:g,dir:"rtl"}),e.jsx(o,{type:"submit",className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 px-6 w-full sm:w-auto",disabled:g||!T.trim(),children:"בדוק"})]})}),L&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium font-heebo mb-2",children:"תוצאה:"}),e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{children:[e.jsx(v,{children:"#"}),e.jsx(v,{children:"מילה"}),e.jsx(v,{children:"קרבה"}),e.jsx(v,{children:"מתחמם?"})]})}),e.jsx(N,{children:e.jsxs(w,{children:[e.jsx(k,{children:"-"}),e.jsx(k,{children:L.word}),e.jsx(k,{children:`${(100*L.similarity).toFixed(2)}%`}),e.jsx(k,{children:L.rank&&L.rank>0?e.jsxs("div",{children:[L.rank,"/1000"]}):e.jsx("span",{children:"רחוק"})})]})})]})})]})]})]})}):e.jsxs(e.Fragment,{children:[I&&e.jsx("div",{className:"text-center text-sm p-3",children:"טוען פרטי משחק..."}),F&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground bg-muted/30 rounded-md p-3 mb-4 font-heebo",children:["ציון הקרבה של המילה הכי קרובה (999/1000) הוא ",e.jsx("strong",{children:(100*F[999]).toFixed(2)}),", ציון הקרבה של המילה העשירית הכי קרובה (990/1000) הוא ",e.jsx("strong",{children:(100*F[990]).toFixed(2)}),", וציון הקרבה של המילה האלף הכי קרובה (1/1000) הוא ",e.jsx("strong",{children:(100*F[1]).toFixed(2)}),"."]}),e.jsxs("div",{className:"space-y-4",children:[H&&e.jsx("div",{className:"animate-in fade-in duration-500 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:["לא נתקענו, פשוט לוקח לנו קצת זמן לחשב את הניחוש הראשון לפעמים :)",e.jsx("br",{}),"אל דאגה, מהניחוש הבא הכול יזרום הרבה יותר מהר"]})]})}),e.jsxs("form",{onSubmit:async e=>{if(e&&e.preventDefault(),!i.trim()||g)return;const s=i.replace(/'/g,""),t=u(s);if(!t.isValid)return void j(t.errorMessage||"שגיאה בבדיקת המילה");j(null);const l=s.trim();if(r.guesses.find(e=>e.word===l))return d(""),B(l),q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{B(null)},2e3),void U(!0);d(""),S.current=!0,C(!0),V.current=setTimeout(()=>{O(!0)},8e3);try{await a(l)}catch(n){const e=n instanceof Error?n.message:"שגיאה בניחוש המילה";e.includes("not found")||e.includes("לא נמצא")||e.includes("Word not found in vocabulary")||e.includes("לא נמצאה במאגר")?j(`אני לא מכיר את המילה ${l}`):j(e)}finally{V.current&&(clearTimeout(V.current),V.current=null),O(!1),S.current=!1,C(!1),U(!0)}},className:"flex flex-row gap-2",autoComplete:"off",style:{minHeight:"50px"},children:[e.jsx("input",{ref:J,type:"search",value:i,onChange:e=>d(e.target.value),placeholder:"נחש מילה...",disabled:!1,dir:"rtl",autoComplete:"off",autoCorrect:"on",autoCapitalize:"none",inputMode:"text",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 text-lg"}),e.jsx(o,{type:"submit",className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 px-4 py-2 text-sm font-medium whitespace-nowrap flex items-center justify-center min-w-[70px] h-10",disabled:!i.trim(),onMouseDown:e=>{e.preventDefault()},onTouchStart:e=>{e.preventDefault()},children:g?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):"נחש"})]}),h&&e.jsx(_,{variant:"destructive",children:e.jsx(D,{children:h})})]})]}),Z&&!r.isComplete&&e.jsxs("div",{className:"space-y-2",ref:K,children:[e.jsx("h3",{className:"text-lg font-bold font-heebo",children:P?"ניחוש קודם":"הניחוש האחרון"}),e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"border-b",children:[e.jsx(v,{className:"text-right w-12 py-2 px-2",children:"#"}),e.jsx(v,{className:"text-right w-24 py-2 px-2",children:"מילה"}),e.jsx(v,{className:"text-center w-20 py-2 px-2",children:"קרבה"}),e.jsx(v,{className:"text-center w-28 py-2 px-2",children:"מתחמם?"})]})}),e.jsx(N,{children:e.jsxs(w,{className:"bg-primary-100 dark:bg-primary-900/30 border-primary-200 dark:border-primary-700",children:[e.jsx(k,{className:"w-12 py-1 px-2 text-xs font-medium text-primary-700 dark:text-primary-300",children:ee}),e.jsx(k,{className:"w-24 font-medium py-1 px-2 text-xs truncate text-primary-700 dark:text-primary-300",children:Z.word}),e.jsx(k,{className:"w-20 text-center py-1 px-2 text-xs text-primary-700 dark:text-primary-300",children:`${(100*Z.similarity).toFixed(2)}%`}),e.jsx(k,{className:"w-28 text-center py-1 px-2",children:Z.rank&&Z.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm min-w-[2px]",style:{width:R(Z.rank)}})}),e.jsxs("span",{className:"text-xs text-primary-700 dark:text-primary-300 font-heebo whitespace-nowrap",children:[Z.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-primary-700 dark:text-primary-300 font-heebo",children:"רחוק"})})]})})]})})]}),se.length>0&&e.jsx("div",{className:Z&&!r.isComplete?"mt-1":"space-y-2",children:e.jsx($,{guesses:se,originalGuesses:r.guesses,showHeader:!Z||r.isComplete,flashingWord:P})}),0===r.guesses.length&&!r.isComplete&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"עדיין אין ניחושים. התחל לנחש!"})]})});T.displayName="GameBoard";const M=({isOpen:r,onClose:t})=>{const[a,o]=s.useState(!0),c=()=>{o(!a)};return e.jsx(l,{open:r,onOpenChange:t,children:e.jsxs(n,{className:"sm:max-w-md",children:[e.jsx(i,{children:e.jsx(d,{className:"text-center",children:a?"התחברות":"הרשמה"})}),e.jsx("div",{className:"space-y-4",children:a?e.jsx(j,{onToggleMode:c}):e.jsx(g,{onToggleMode:c})})]})})},L=()=>{const{isLoading:r}=c(),{isLoading:t}=h(),[a,l]=s.useState(!1),[n,i]=s.useState(!1);return s.useEffect(()=>{l(!0)},[]),!a||t?e.jsx(C,{children:e.jsx("div",{className:"flex flex-col justify-center items-center h-64",children:e.jsx("div",{className:"text-xl text-primary-500 dark:text-primary-400 mb-4",children:"טוען..."})})}):e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[r?e.jsx("div",{className:"flex flex-col justify-center items-center h-64",children:e.jsx("div",{className:"text-xl text-primary-500 dark:text-primary-400 mb-4",children:"טוען משחק..."})}):e.jsx(T,{}),e.jsx(M,{isOpen:n,onClose:()=>i(!1)})]})})};export{L as default};
