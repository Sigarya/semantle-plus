import{j as e}from"./ui.DDQN6UUz.js";import{r as s,R as r}from"./vendor.CJDJhWJD.js";import{c as t,a,D as n,b as l,d as i,e as o,B as d,u as c,f as m,s as x,L as u,v as h,g as p,h as f}from"./index.Vc1oMdpK.js";import{C as g,a as j,L as b,R as y,P as v}from"./PageLayout.CZieBVrS.js";import{T as w,a as N,b as k,c as C,d as S,e as E}from"./table.nI6HvDPQ.js";import"./utils.CIxrdROE.js";const _=a("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),D=s.forwardRef(({className:s,variant:r,...a},n)=>e.jsx("div",{ref:n,role:"alert",className:t(_({variant:r}),s),...a}));D.displayName="Alert";s.forwardRef(({className:s,...r},a)=>e.jsx("h5",{ref:a,className:t("mb-1 font-medium leading-none tracking-tight",s),...r})).displayName="AlertTitle";const $=s.forwardRef(({className:s,...r},a)=>e.jsx("div",{ref:a,className:t("text-sm [&_p]:leading-relaxed",s),...r}));$.displayName="AlertDescription";const T=r.memo(({guesses:s,originalGuesses:r,showHeader:t=!0,flashingWord:a})=>0===s.length?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"אין ניחושים קודמים"}):e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(w,{children:[t&&e.jsx(N,{children:e.jsxs(k,{className:"border-b",children:[e.jsx(C,{className:"text-right w-12 py-2 px-2",children:"#"}),e.jsx(C,{className:"text-right w-24 py-2 px-2",children:"מילה"}),e.jsx(C,{className:"text-center w-20 py-2 px-2",children:"קרבה"}),e.jsx(C,{className:"text-center w-28 py-2 px-2",children:"מתחמם?"})]})}),e.jsx(S,{children:s.map((s,r)=>{const t=s.order||r+1,n=a===s.word;return e.jsxs(k,{className:`${s.isCorrect?"bg-green-500/20":""} ${n?"animate-pulse bg-yellow-200 dark:bg-yellow-900/50":""}`,children:[e.jsx(E,{className:"w-12 py-1 px-2 text-xs",children:t}),e.jsx(E,{className:"w-24 font-medium py-1 px-2 text-xs truncate",children:s.word}),e.jsx(E,{className:"w-20 text-center py-1 px-2 text-xs",children:`${(100*s.similarity).toFixed(2)}%`}),e.jsx(E,{className:"w-28 text-center py-1 px-2",children:s.rank&&s.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm transition-all duration-200",style:{width:`${Math.min(s.rank/1e3*100,100)}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground font-heebo whitespace-nowrap",children:[s.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-muted-foreground font-heebo",children:"רחוק"})})]},`${s.word}-${r}`)})})]})}));T.displayName="GuessTable";const R=()=>{const[r,t]=s.useState(!1);s.useEffect(()=>{localStorage.getItem("semantle-has-visited")||t(!0)},[]);const a=()=>{localStorage.setItem("semantle-has-visited","true"),t(!1)};return e.jsx(n,{open:r,onOpenChange:a,children:e.jsxs(l,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",dir:"rtl",children:[e.jsx(i,{children:e.jsx(o,{className:"text-xl font-bold text-center font-heebo",children:"נחשו את המילה הסודית"})}),e.jsxs("div",{className:"space-y-4 text-sm leading-relaxed",children:[e.jsx("p",{children:"אפשר לנחש כל מילה. המילה הסודית תהיה תמיד מילה אחת בלבד. אחרי כל ניחוש, המשחק יראה לכם עד כמה המילה קרובה במשמעות למילה הסודית. הקרבה היא לא באיות אלא במשמעות - מה שנקרא קרבה סמנטית."}),e.jsx("p",{children:"המדד הזה מבוסס על מודל בשם Word2Vec, שלמד את השפה מטקסטים של ויקיפדיה. במילים פשוטות: שתי מילים נחשבות קרובות יותר ככל שיותר סביר שתופענה יחד בהקשרים דומים."}),e.jsx("p",{children:"המשחק נותן ציון בין -100 ל־100: 100- זה מאוד רחוק, 100 זו המילה הסודית עצמה."}),e.jsx("p",{children:"בנוסף, תראו אם הניחוש שלכם נמצא בין אלף המילים הקרובות ביותר למילה הסודית - ככה תדעו אם אתם בכיוון."}),e.jsx("p",{children:"המילה הסודית יכולה להיות מכל חלק דיבר (שם עצם, פועל, תואר וכו'), אבל תמיד תהיה מילה אחת בלבד."}),e.jsx("p",{children:"בניגוד ל־Wordle, כאן לא מגבילים אתכם לשישה ניחושים - לרוב תצטרכו הרבה ניחושים כדי להגיע למטרה. המשחק מתעדכן בכל יום עם המילה שהייתה אתמול במשחק המקורי."}),e.jsxs("div",{className:"border-t pt-4 mt-6",children:[e.jsx("h3",{className:"font-bold mb-2 font-heebo",children:"מה שונה ב־סמנטעל +"}),e.jsx("p",{children:"בדף הראשי תוכלו לשחק בכל יום במילה שהופיעה אתמול במשחק המקורי."}),e.jsx("p",{className:"mt-2",children:'דרך דף "היסטוריה" אפשר לגשת לכל אחת מהמילים מהעבר ולשחק אותן מתי שתרצו - בלי לחץ של זמן.'})]}),e.jsx("p",{className:"font-bold text-center font-heebo",children:"בהצלחה!"})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(d,{onClick:a,className:"px-8",children:"בואו נתחיל!"})})]})})},G=e=>{if(!e||e<=0)return"0%";return`${Math.min(e/1e3*100,100)}%`},L=r.memo(()=>{const{gameState:r,currentWord:t,makeGuess:a,resetGame:n,isLoading:l}=c(),{toast:i}=m(),[o,f]=s.useState(""),[b,y]=s.useState(null),[v,_]=s.useState(!1),L=s.useRef(!1),[M,A]=s.useState(""),[I,W]=s.useState(null),[F,P]=s.useState(null),[O,V]=s.useState(!1),[z,B]=s.useState(!1),H=s.useRef(null),[q,U]=s.useState(null),Y=s.useRef(null),[J,K]=s.useState(!1),Q=s.useRef(null),X=s.useRef(null),Z=s.useCallback(async()=>{if(r.wordDate){V(!0);try{const{data:s,error:t}=await x.from("daily_sample_ranks").select("*").eq("word_date",r.wordDate).single();if(t&&"PGRST116"!==t.code)throw new Error("שגיאה בטעינת נתונים מהמאגר");if(s)P({1:s.rank_1_score,990:s.rank_990_score,999:s.rank_999_score});else{const s=r.wordDate.split("-");if(3!==s.length)throw new Error("פורמט תאריך לא תקין");const t=`${s[2]}/${s[1]}/${s[0]}`,a=await fetch(`https://combined-he-w2v-api.onrender.com/sample-ranks?date=${encodeURIComponent(t)}`);if(!a.ok)throw new Error(`שגיאה בקבלת נתונים מהשרת: ${a.status}`);const n=await a.json();if(!n.samples||"object"!=typeof n.samples)throw new Error("פורמט תגובה לא תקין מהשרת");P(n.samples);try{await x.from("daily_sample_ranks").insert({word_date:r.wordDate,rank_1_score:n.samples[1],rank_990_score:n.samples[990],rank_999_score:n.samples[999]})}catch(e){console.warn("לא ניתן לשמור במאגר:",e)}}}catch(s){console.error("שגיאה בטעינת נתוני דירוג:",s)}finally{V(!1)}}},[r.wordDate]);s.useEffect(()=>{Z()},[Z]),s.useEffect(()=>()=>{Y.current&&clearTimeout(Y.current),H.current&&clearTimeout(H.current)},[]),s.useEffect(()=>{J&&!r.isComplete&&Q.current&&(Q.current.focus(),K(!1))},[J,r.isComplete]);const ee=s.useMemo(()=>new Date(r.wordDate).toLocaleDateString("he-IL"),[r.wordDate]);if(s.useEffect(()=>{l||r.isComplete||!Q.current||Q.current.focus()},[l,r.isComplete]),l)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-xl",children:"טוען משחק..."})});const se=q?r.guesses.find(e=>e.word===q):null,re=se||r.guesses[r.guesses.length-1],te=se?se.order||r.guesses.findIndex(e=>e.word===q)+1:re?.order||r.guesses.length,ae=[...r.isComplete?r.guesses:r.guesses.slice(0,-1)].sort((e,s)=>s.similarity-e.similarity);return e.jsxs("div",{className:"space-y-4 max-w-3xl mx-auto min-h-screen px-2 sm:px-4 pt-4 pb-20 sm:pb-24",style:{overflowAnchor:"none"},children:[e.jsx(R,{}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold font-heebo",children:"סמנטעל +"}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["משחק מיום ",ee]})]}),r.isComplete?e.jsx(g,{className:"bg-background dark:bg-slate-800 border-primary-200 dark:border-slate-700",children:e.jsxs(j,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400 text-2xl font-bold mb-4",children:"כל הכבוד! מצאת את המילה!"}),e.jsxs("div",{className:"text-xl mb-4",children:["המילה היא: ",e.jsx("span",{className:"font-bold text-primary-500 dark:text-primary-400",children:t})]}),e.jsxs("div",{className:"text-muted-foreground mb-6",children:["מספר ניחושים: ",r.guesses.length]}),e.jsx("div",{className:"mb-6",children:e.jsxs(d,{onClick:async()=>{if(t)try{const e=p(r.wordDate,r.guesses,t);if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(e);else{const s=document.createElement("textarea");s.value=e,s.style.position="fixed",s.style.left="-999999px",s.style.top="-999999px",document.body.appendChild(s),s.focus(),s.select(),document.execCommand("copy"),document.body.removeChild(s)}i({title:"העתקת!",description:"אפשר להדביק ולשתף ברשתות החברתיות",duration:3e3})}catch(e){console.error("Error sharing:",e),i({title:"שגיאה",description:"לא ניתן להעתיק את הטקסט. נסה שוב.",variant:"destructive",duration:3e3})}},variant:"outline",className:"bg-green-50 hover:bg-green-100 dark:bg-green-900/20 dark:hover:bg-green-900/30 border-green-200 dark:border-green-700 text-green-700 dark:text-green-300 hover:text-green-800 dark:hover:text-green-200",children:[e.jsx("svg",{className:"w-4 h-4 ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"})}),"שתף תוצאה"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-center",children:[e.jsx(d,{onClick:n,className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 w-full sm:w-auto",children:"שחק שוב"}),e.jsx(u,{to:"/history",className:"block w-full sm:w-auto",children:e.jsx(d,{variant:"outline",className:"w-full sm:w-auto",children:"משחק מיום אחר"})})]}),e.jsxs("div",{className:"mt-8 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-medium font-heebo mb-4",children:"נסה מילים נוספות"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"נסה מילים אחרות לראות כמה הן קרובות למילה"}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),!M.trim())return;const s=M.replace(/'/g,""),t=h(s);if(t.isValid){y(null),_(!0);try{const{data:e,error:t}=await x.functions.invoke("calculate-similarity",{body:{guess:s,date:r.wordDate}});if(t)throw new Error("שגיאה בחישוב הדמיון");if(e.error)throw e.error.includes("Word not found in vocabulary")||e.error.includes("not found")||e.error.includes("לא נמצא")||e.error.includes("לא נמצאה במאגר")?new Error(`אני לא מכיר את המילה ${s}`):new Error(e.error);W({word:s,similarity:e.similarity,rank:e.rank}),A("")}catch(a){const e=a instanceof Error?a.message:"שגיאה בבדיקת דמיון";e.includes("Word not found in vocabulary")||e.includes("not found")||e.includes("לא נמצא")||e.includes("לא נמצאה במאגר")?y(`אני לא מכיר את המילה ${s}`):e.includes("בעיה בגישה ל-API")||e.includes("API")?y("בעיה בגישה לשרת - נסה שוב בעוד כמה שניות"):y(e)}finally{_(!1)}}else y(t.errorMessage||"שגיאה בבדיקת המילה")},className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"text",value:M,onChange:e=>A(e.target.value),className:"text-lg flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background",placeholder:"נסה מילה...",disabled:v,dir:"rtl"}),e.jsx(d,{type:"submit",className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 px-6 w-full sm:w-auto",disabled:v||!M.trim(),children:"בדוק"})]})}),I&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium font-heebo mb-2",children:"תוצאה:"}),e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(w,{children:[e.jsx(N,{children:e.jsxs(k,{children:[e.jsx(C,{children:"#"}),e.jsx(C,{children:"מילה"}),e.jsx(C,{children:"קרבה"}),e.jsx(C,{children:"מתחמם?"})]})}),e.jsx(S,{children:e.jsxs(k,{children:[e.jsx(E,{children:"-"}),e.jsx(E,{children:I.word}),e.jsx(E,{children:`${(100*I.similarity).toFixed(2)}%`}),e.jsx(E,{children:I.rank&&I.rank>0?e.jsxs("div",{children:[I.rank,"/1000"]}):e.jsx("span",{children:"רחוק"})})]})})]})})]})]})]})}):e.jsxs(e.Fragment,{children:[O&&e.jsx("div",{className:"text-center text-sm p-3",children:"טוען פרטי משחק..."}),F&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground bg-muted/30 rounded-md p-3 mb-4 font-heebo",children:["ציון הקרבה של המילה הכי קרובה (999/1000) הוא ",e.jsx("strong",{children:(100*F[999]).toFixed(2)}),", ציון הקרבה של המילה העשירית הכי קרובה (990/1000) הוא ",e.jsx("strong",{children:(100*F[990]).toFixed(2)}),", וציון הקרבה של המילה האלף הכי קרובה (1/1000) הוא ",e.jsx("strong",{children:(100*F[1]).toFixed(2)}),"."]}),e.jsxs("div",{className:"space-y-4",children:[z&&e.jsx("div",{className:"animate-in fade-in duration-500 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:["לא נתקענו, פשוט לוקח לנו קצת זמן לחשב את הניחוש הראשון לפעמים :)",e.jsx("br",{}),"אל דאגה, מהניחוש הבא הכול יזרום הרבה יותר מהר"]})]})}),e.jsxs("form",{onSubmit:async e=>{if(e&&e.preventDefault(),!o.trim()||v)return;const s=o.replace(/'/g,"");console.log("Original input:",o),console.log("Sanitized input:",s),console.log("Geresh removed:",o.includes("'")?"YES":"NO");const t=h(s);if(console.log("Validation result:",t),!t.isValid)return void y(t.errorMessage||"שגיאה בבדיקת המילה");y(null);const n=s.trim();if(r.guesses.find(e=>e.word===n))return f(""),U(n),Y.current&&clearTimeout(Y.current),Y.current=setTimeout(()=>{U(null)},2e3),void K(!0);f(""),L.current=!0,_(!0),H.current=setTimeout(()=>{B(!0)},8e3);try{console.log("About to call makeGuess with word:",n),await a(n)}catch(l){const e=l instanceof Error?l.message:"שגיאה בניחוש המילה";console.log("Error from makeGuess:",e),e.includes("not found")||e.includes("לא נמצא")||e.includes("Word not found in vocabulary")||e.includes("לא נמצאה במאגר")?y(`אני לא מכיר את המילה ${n}`):e.includes("בעיה בגישה ל-API")||e.includes("API")?y("בעיה בגישה לשרת - נסה שוב בעוד כמה שניות"):y(e)}finally{H.current&&(clearTimeout(H.current),H.current=null),B(!1),L.current=!1,_(!1),K(!0)}},className:"flex flex-row gap-2",autoComplete:"off",style:{minHeight:"50px"},children:[e.jsx("input",{ref:Q,type:"search",value:o,onChange:e=>f(e.target.value),placeholder:"נחש מילה...",disabled:!1,dir:"rtl",autoComplete:"off",autoCorrect:"on",autoCapitalize:"none",inputMode:"text",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 text-lg"}),e.jsx(d,{type:"submit",className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 px-4 py-2 text-sm font-medium whitespace-nowrap flex items-center justify-center min-w-[70px] h-10",disabled:!o.trim(),onMouseDown:e=>{e.preventDefault()},onTouchStart:e=>{e.preventDefault()},children:v?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):"נחש"})]}),b&&e.jsx(D,{variant:"destructive",children:e.jsx($,{children:b})})]})]}),re&&!r.isComplete&&e.jsxs("div",{className:"space-y-2",ref:X,children:[e.jsx("h3",{className:"text-lg font-bold font-heebo",children:q?"ניחוש קודם":"הניחוש האחרון"}),e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(w,{children:[e.jsx(N,{children:e.jsxs(k,{className:"border-b",children:[e.jsx(C,{className:"text-right w-12 py-2 px-2",children:"#"}),e.jsx(C,{className:"text-right w-24 py-2 px-2",children:"מילה"}),e.jsx(C,{className:"text-center w-20 py-2 px-2",children:"קרבה"}),e.jsx(C,{className:"text-center w-28 py-2 px-2",children:"מתחמם?"})]})}),e.jsx(S,{children:e.jsxs(k,{className:"bg-primary-100 dark:bg-primary-900/30 border-primary-200 dark:border-primary-700",children:[e.jsx(E,{className:"w-12 py-1 px-2 text-xs font-medium text-primary-700 dark:text-primary-300",children:te}),e.jsx(E,{className:"w-24 font-medium py-1 px-2 text-xs truncate text-primary-700 dark:text-primary-300",children:re.word}),e.jsx(E,{className:"w-20 text-center py-1 px-2 text-xs text-primary-700 dark:text-primary-300",children:`${(100*re.similarity).toFixed(2)}%`}),e.jsx(E,{className:"w-28 text-center py-1 px-2",children:re.rank&&re.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm min-w-[2px]",style:{width:G(re.rank)}})}),e.jsxs("span",{className:"text-xs text-primary-700 dark:text-primary-300 font-heebo whitespace-nowrap",children:[re.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-primary-700 dark:text-primary-300 font-heebo",children:"רחוק"})})]})})]})})]}),ae.length>0&&e.jsx("div",{className:re&&!r.isComplete?"mt-1":"space-y-2",children:e.jsx(T,{guesses:ae,originalGuesses:r.guesses,showHeader:!re||r.isComplete,flashingWord:q})}),0===r.guesses.length&&!r.isComplete&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"עדיין אין ניחושים. התחל לנחש!"})]})});L.displayName="GameBoard";const M=({isOpen:r,onClose:t})=>{const[a,d]=s.useState(!0),c=()=>{d(!a)};return e.jsx(n,{open:r,onOpenChange:t,children:e.jsxs(l,{className:"sm:max-w-md",children:[e.jsx(i,{children:e.jsx(o,{className:"text-center",children:a?"התחברות":"הרשמה"})}),e.jsx("div",{className:"space-y-4",children:a?e.jsx(b,{onToggleMode:c}):e.jsx(y,{onToggleMode:c})})]})})},A=()=>{const{isLoading:r}=c(),{isLoading:t}=f(),[a,n]=s.useState(!1),[l,i]=s.useState(!1);return s.useEffect(()=>{n(!0)},[]),!a||t?e.jsx(v,{children:e.jsx("div",{className:"flex flex-col justify-center items-center h-64",children:e.jsx("div",{className:"text-xl text-primary-500 dark:text-primary-400 mb-4",children:"טוען..."})})}):e.jsx(v,{children:e.jsxs("div",{className:"space-y-6",children:[r?e.jsx("div",{className:"flex flex-col justify-center items-center h-64",children:e.jsx("div",{className:"text-xl text-primary-500 dark:text-primary-400 mb-4",children:"טוען משחק..."})}):e.jsx(L,{}),e.jsx(M,{isOpen:l,onClose:()=>i(!1)})]})})};export{A as default};
