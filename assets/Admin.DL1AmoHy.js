import{j as e}from"./ui.DDQN6UUz.js";import{r}from"./vendor.CJDJhWJD.js";import{u as t,j as a,k as s,C as o,h as i,i as d,f as l,m as n,I as c,B as g,l as x,s as h,g as m}from"./index.G7n8Q-pX.js";import{T as w,a as j,b as y,c as u,d as b,e as v}from"./table.-EjUMR3o.js";import{P as p}from"./PageLayout.D8LsmbH_.js";import"./utils.CIxrdROE.js";const k=()=>{const{dailyWords:m,setWordForDate:p}=t(),{toast:k}=a();s();const[f,N]=r.useState(""),[S,D]=r.useState((new Date).toISOString().split("T")[0]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs(o,{className:"bg-white dark:bg-slate-800 border-gray-200 dark:border-slate-700",children:[e.jsx(i,{children:e.jsx(d,{className:"text-xl text-gray-900 dark:text-white",children:"הגדר מילה חדשה"})}),e.jsx(l,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),f.trim())try{const e=new Date(S+"T12:00:00"),r=`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`,{data:t,error:a}=await h.functions.invoke("set-daily-word",{body:{date:r,word:f.trim()}});if(a)throw console.error("Error calling edge function:",a),new Error("שגיאה בקשת השרת");if(t?.error)throw console.error("Server error:",t.error),new Error(t.error);await p(f,S),k({title:"הצלחה",description:`המילה "${f}" נקבעה לתאריך ${x(new Date(S))} בשני השרתים`}),N("")}catch(r){k({variant:"destructive",title:"שגיאה",description:r instanceof Error?r.message:"אירעה שגיאה בהגדרת המילה"})}else k({variant:"destructive",title:"שגיאה",description:"אנא הכנס מילה"})},className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"date",className:"text-gray-700 dark:text-gray-300",children:"תאריך"}),e.jsx(c,{id:"date",type:"date",value:S,onChange:e=>D(e.target.value),className:"rtl:text-right bg-white dark:bg-slate-700 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"word",className:"text-gray-700 dark:text-gray-300",children:"מילה"}),e.jsx(c,{id:"word",value:f,onChange:e=>N(e.target.value),placeholder:"הכנס מילה חדשה...",dir:"rtl",className:"bg-white dark:bg-slate-700 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-white"})]}),e.jsx(g,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"שמור מילה"})]})})]}),e.jsxs(o,{className:"bg-white dark:bg-slate-800 border-gray-200 dark:border-slate-700",children:[e.jsx(i,{children:e.jsx(d,{className:"text-xl text-gray-900 dark:text-white",children:"מילים מוגדרות"})}),e.jsx(l,{children:e.jsxs(w,{children:[e.jsx(j,{children:e.jsxs(y,{children:[e.jsx(u,{className:"text-right text-gray-700 dark:text-gray-300",children:"תאריך"}),e.jsx(u,{className:"text-right text-gray-700 dark:text-gray-300",children:"מילה"}),e.jsx(u,{className:"text-right text-gray-700 dark:text-gray-300",children:"פעולות"})]})}),e.jsx(b,{children:m.sort((e,r)=>new Date(r.date).getTime()-new Date(e.date).getTime()).map(r=>e.jsxs(y,{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e.jsx(v,{className:"text-gray-900 dark:text-white",children:x(new Date(r.date))}),e.jsx(v,{className:"text-gray-900 dark:text-white",children:r.word}),e.jsx(v,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{N(r.word),D(r.date)},className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-600",children:"ערוך"}),e.jsx(g,{variant:"default",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:e=>{e.preventDefault(),e.stopPropagation(),(async(e,r)=>{try{console.log("Setting word on server:",{word:e,date:r});const t=new Date(r+"T12:00:00"),a=`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`;console.log("Formatted date:",a),console.log("Calling edge function set-daily-word...");const{data:s,error:o}=await h.functions.invoke("set-daily-word",{body:{date:a,word:e.trim()}});if(console.log("Edge function response:",{data:s,error:o}),o)throw console.error("Error calling edge function:",o),new Error(`שגיאה בקשת השרת: ${o.message||o}`);if(s?.error)throw console.error("Server error:",s.error),new Error(s.error);k({title:"הצלחה",description:`המילה "${e}" נקבעה בהצלחה בשרת החיצוני לתאריך ${x(t)}`})}catch(t){console.error("Full error in handleSetWordOnServer:",t),k({variant:"destructive",title:"שגיאה",description:t instanceof Error?t.message:"אירעה שגיאה בהגדרת המילה בשרת החיצוני"})}})(r.word,r.date)},children:"הגדר"})]})})]},r.date))})]})})]})]})},f=()=>{const{currentUser:t}=m(),o=s(),{toast:i}=a();return r.useEffect(()=>{t?.isAdmin||(i({variant:"destructive",title:"גישה נדחתה",description:"אין לך הרשאה לצפות בדף זה"}),o("/"))},[t,o,i]),t?.isAdmin?e.jsx(p,{title:"פאנל ניהול",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsx(k,{})})}):null};export{f as default};
