import{j as e}from"./ui.DDQN6UUz.js";import{r as s,R as r}from"./vendor.CJDJhWJD.js";import{B as t}from"./button.BbM6K3t3.js";import{D as a,a as l,b as n,c as i,C as d,d as c,L as o,R as m}from"./Header.B1veeuuB.js";import{c as x,a as u,u as h,s as p,L as f,i as j,b as g}from"./index.CuLL1jUX.js";import{T as b,a as y,b as w,c as v,d as N,e as k}from"./table.BsAL8-Zx.js";import{P as C}from"./PageLayout.CNzVwKqw.js";import"./utils.CIxrdROE.js";const S=u("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),_=s.forwardRef(({className:s,variant:r,...t},a)=>e.jsx("div",{ref:a,role:"alert",className:x(S({variant:r}),s),...t}));_.displayName="Alert";s.forwardRef(({className:s,...r},t)=>e.jsx("h5",{ref:t,className:x("mb-1 font-medium leading-none tracking-tight",s),...r})).displayName="AlertTitle";const D=s.forwardRef(({className:s,...r},t)=>e.jsx("div",{ref:t,className:x("text-sm [&_p]:leading-relaxed",s),...r}));D.displayName="AlertDescription";const E=r.memo(({guesses:s,originalGuesses:r,showHeader:t=!0})=>0===s.length?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"אין ניחושים קודמים"}):e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(b,{children:[t&&e.jsx(y,{children:e.jsxs(w,{className:"border-b",children:[e.jsx(v,{className:"text-right w-12 py-2 px-2",children:"#"}),e.jsx(v,{className:"text-right w-24 py-2 px-2",children:"מילה"}),e.jsx(v,{className:"text-center w-20 py-2 px-2",children:"קרבה"}),e.jsx(v,{className:"text-center w-28 py-2 px-2",children:"מתחמם?"})]})}),e.jsx(N,{children:s.map((t,a)=>{const l=r.findIndex((e,l)=>e.word===t.word&&e.similarity===t.similarity&&r.slice(0,l).filter(e=>e.word===t.word).length===s.slice(0,a).filter(e=>e.word===t.word).length)+1;return e.jsxs(w,{className:""+(t.isCorrect?"bg-green-500/20":""),children:[e.jsx(k,{className:"w-12 py-1 px-2 text-xs",children:l}),e.jsx(k,{className:"w-24 font-medium py-1 px-2 text-xs truncate",children:t.word}),e.jsx(k,{className:"w-20 text-center py-1 px-2 text-xs",children:`${(100*t.similarity).toFixed(2)}%`}),e.jsx(k,{className:"w-28 text-center py-1 px-2",children:t.rank&&t.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm transition-all duration-200",style:{width:`${Math.min(t.rank/1e3*100,100)}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground font-heebo whitespace-nowrap",children:[t.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-muted-foreground font-heebo",children:"רחוק"})})]},`${t.word}-${a}`)})})]})}));E.displayName="GuessTable";const $=()=>{const[r,d]=s.useState(!1);s.useEffect(()=>{localStorage.getItem("semantle-has-visited")||d(!0)},[]);const c=()=>{localStorage.setItem("semantle-has-visited","true"),d(!1)};return e.jsx(a,{open:r,onOpenChange:c,children:e.jsxs(l,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",dir:"rtl",children:[e.jsx(n,{children:e.jsx(i,{className:"text-xl font-bold text-center font-heebo",children:"נחשו את המילה הסודית"})}),e.jsxs("div",{className:"space-y-4 text-sm leading-relaxed",children:[e.jsx("p",{children:"אפשר לנחש כל מילה. המילה הסודית תהיה תמיד מילה אחת בלבד. אחרי כל ניחוש, המשחק יראה לכם עד כמה המילה קרובה במשמעות למילה הסודית. הקרבה היא לא באיות אלא במשמעות - מה שנקרא קרבה סמנטית."}),e.jsx("p",{children:"המדד הזה מבוסס על מודל בשם Word2Vec, שלמד את השפה מטקסטים של ויקיפדיה. במילים פשוטות: שתי מילים נחשבות קרובות יותר ככל שיותר סביר שתופענה יחד בהקשרים דומים."}),e.jsx("p",{children:"המשחק נותן ציון בין -100 ל־100: 100- זה מאוד רחוק, 100 זו המילה הסודית עצמה."}),e.jsx("p",{children:"בנוסף, תראו אם הניחוש שלכם נמצא בין אלף המילים הקרובות ביותר למילה הסודית - ככה תדעו אם אתם בכיוון."}),e.jsx("p",{children:"המילה הסודית יכולה להיות מכל חלק דיבר (שם עצם, פועל, תואר וכו'), אבל תמיד תהיה מילה אחת בלבד."}),e.jsx("p",{children:"בניגוד ל־Wordle, כאן לא מגבילים אתכם לשישה ניחושים - לרוב תצטרכו הרבה ניחושים כדי להגיע למטרה. המשחק מתעדכן בכל יום עם המילה שהייתה אתמול במשחק המקורי."}),e.jsxs("div",{className:"border-t pt-4 mt-6",children:[e.jsx("h3",{className:"font-bold mb-2 font-heebo",children:"מה שונה ב־סמנטעל +"}),e.jsx("p",{children:"בדף הראשי תוכלו לשחק בכל יום במילה שהופיעה אתמול במשחק המקורי."}),e.jsx("p",{className:"mt-2",children:'דרך דף "היסטוריה" אפשר לגשת לכל אחת מהמילים מהעבר ולשחק אותן מתי שתרצו - בלי לחץ של זמן.'})]}),e.jsx("p",{className:"font-bold text-center font-heebo",children:"בהצלחה!"})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(t,{onClick:c,className:"px-8",children:"בואו נתחיל!"})})]})})},R=e=>{if(!e||e<=0)return"0%";return`${Math.min(e/1e3*100,100)}%`},T=r.memo(()=>{const{gameState:r,currentWord:a,makeGuess:l,resetGame:n,isLoading:i}=h(),[o,m]=s.useState(""),[x,u]=s.useState(null),[g,C]=s.useState(!1);s.useRef(null),s.useRef(null);const S=s.useRef(!1),[T,L]=s.useState(""),[F,G]=s.useState(null),[M,I]=s.useState(null),[W,A]=s.useState(!1),[H,O]=s.useState(!1),B=s.useRef(null),P=s.useRef(null),V=s.useRef(null),q=s.useCallback(async()=>{if(r.wordDate){A(!0);try{const{data:s,error:t}=await p.from("daily_sample_ranks").select("*").eq("word_date",r.wordDate).single();if(t&&"PGRST116"!==t.code)throw new Error("שגיאה בטעינת נתונים מהמאגר");if(s)I({1:s.rank_1_score,990:s.rank_990_score,999:s.rank_999_score});else{const s=r.wordDate.split("-");if(3!==s.length)throw new Error("פורמט תאריך לא תקין");const t=`${s[2]}/${s[1]}/${s[0]}`,a=await fetch(`https://hebrew-w2v.onrender.com/sample-ranks?date=${encodeURIComponent(t)}`);if(!a.ok)throw new Error(`שגיאה בקבלת נתונים מהשרת: ${a.status}`);const l=await a.json();if(!l.samples||"object"!=typeof l.samples)throw new Error("פורמט תגובה לא תקין מהשרת");I(l.samples);try{await p.from("daily_sample_ranks").insert({word_date:r.wordDate,rank_1_score:l.samples[1],rank_990_score:l.samples[990],rank_999_score:l.samples[999]})}catch(e){console.warn("לא ניתן לשמור במאגר:",e)}}}catch(s){console.error("שגיאה בטעינת נתוני דירוג:",s)}finally{A(!1)}}},[r.wordDate]);s.useEffect(()=>{q()},[q]);const z=s.useCallback(e=>{!r.isComplete&&P.current&&(e.preventDefault(),P.current.focus())},[r.isComplete]);s.useEffect(()=>{i||r.isComplete||!P.current||document.activeElement===P.current||P.current.focus()},[i,r.isComplete,r.guesses.length]);const U=s.useMemo(()=>new Date(r.wordDate).toLocaleDateString("he-IL"),[r.wordDate]);if(s.useEffect(()=>{i||r.isComplete||!P.current||P.current.focus()},[i,r.isComplete]),i)return e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-xl",children:"טוען משחק..."})});const J=r.guesses.find(e=>e.word===o.trim())||r.guesses[r.guesses.length-1],K=(r.isComplete?r.guesses:r.guesses.slice(0,-1)).sort((e,s)=>s.similarity-e.similarity);return e.jsxs("div",{className:"space-y-4 max-w-3xl mx-auto min-h-screen px-2 sm:px-4 pt-4 pb-20 sm:pb-24",style:{overflowAnchor:"none"},children:[e.jsx($,{}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold font-heebo",children:"סמנטעל +"}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-2",children:["משחק מיום ",U]})]}),r.isComplete?e.jsx(d,{className:"bg-background dark:bg-slate-800 border-primary-200 dark:border-slate-700",children:e.jsxs(c,{className:"pt-6 text-center",children:[e.jsx("div",{className:"text-green-600 dark:text-green-400 text-2xl font-bold mb-4",children:"כל הכבוד! מצאת את המילה!"}),e.jsxs("div",{className:"text-xl mb-4",children:["המילה היא: ",e.jsx("span",{className:"font-bold text-primary-500 dark:text-primary-400",children:a})]}),e.jsxs("div",{className:"text-muted-foreground mb-6",children:["מספר ניחושים: ",r.guesses.length]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-center",children:[e.jsx(t,{onClick:n,className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 w-full sm:w-auto",children:"שחק שוב"}),e.jsx(f,{to:"/history",className:"block w-full sm:w-auto",children:e.jsx(t,{variant:"outline",className:"w-full sm:w-auto",children:"משחק מיום אחר"})})]}),e.jsxs("div",{className:"mt-8 border-t border-gray-200 dark:border-gray-700 pt-6",children:[e.jsx("h3",{className:"text-lg font-medium font-heebo mb-4",children:"נסה מילים נוספות"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"נסה מילים אחרות לראות כמה הן קרובות למילה"}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),T.trim())if(j(T)){u(null),C(!0);try{const{data:e,error:s}=await p.functions.invoke("calculate-similarity",{body:{guess:T,date:r.wordDate}});if(s)throw new Error("שגיאה בחישוב הדמיון");if(e.error)throw e.error.includes("Word not found in vocabulary")?new Error(`אני לא מכיר את המילה ${T}`):new Error(e.error);G({word:T,similarity:e.similarity,rank:e.rank}),L("")}catch(s){const e=s instanceof Error?s.message:"שגיאה בבדיקת דמיון";e.includes("Word not found in vocabulary")?u(`אני לא מכיר את המילה ${T}`):u(e)}finally{C(!1)}}else u("אנא הזן מילה בעברית בלבד")},className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"text",value:T,onChange:e=>L(e.target.value),className:"text-lg flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background",placeholder:"נסה מילה...",disabled:g,dir:"rtl"}),e.jsx(t,{type:"submit",className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 px-6 w-full sm:w-auto",disabled:g||!T.trim(),children:"בדוק"})]})}),F&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium font-heebo mb-2",children:"תוצאה:"}),e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{children:[e.jsx(v,{children:"#"}),e.jsx(v,{children:"מילה"}),e.jsx(v,{children:"קרבה"}),e.jsx(v,{children:"מתחמם?"})]})}),e.jsx(N,{children:e.jsxs(w,{children:[e.jsx(k,{children:"-"}),e.jsx(k,{children:F.word}),e.jsx(k,{children:`${(100*F.similarity).toFixed(2)}%`}),e.jsx(k,{children:F.rank&&F.rank>0?e.jsxs("div",{children:[F.rank,"/1000"]}):e.jsx("span",{children:"רחוק"})})]})})]})})]})]})]})}):e.jsxs(e.Fragment,{children:[W&&e.jsx("div",{className:"text-center text-sm p-3",children:"טוען פרטי משחק..."}),M&&e.jsxs("div",{className:"text-center text-sm text-muted-foreground bg-muted/30 rounded-md p-3 mb-4 font-heebo",children:["ציון הקרבה של המילה הכי קרובה (999/1000) הוא ",e.jsx("strong",{children:(100*M[999]).toFixed(2)}),", ציון הקרבה של המילה העשירית הכי קרובה (990/1000) הוא ",e.jsx("strong",{children:(100*M[990]).toFixed(2)}),", וציון הקרבה של המילה האלף הכי קרובה (1/1000) הוא ",e.jsx("strong",{children:(100*M[1]).toFixed(2)}),"."]}),e.jsxs("div",{className:"space-y-4",children:[H&&e.jsx("div",{className:"animate-in fade-in duration-500 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md p-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsxs("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:["לא נתקענו, פשוט לוקח לנו קצת זמן לחשב את הניחוש הראשון לפעמים :)",e.jsx("br",{}),"אל דאגה, מהניחוש הבא הכול יזרום הרבה יותר מהר"]})]})}),e.jsxs("form",{onSubmit:async e=>{if(e&&e.preventDefault(),!o.trim()||g)return;if(!j(o))return void u("אנא הזן מילה בעברית בלבד");u(null);const s=o.trim();if(r.guesses.find(e=>e.word===s))return m(""),S.current=!0,C(!0),void setTimeout(()=>{S.current=!1,C(!1)},200);m(""),S.current=!0,C(!0),B.current=setTimeout(()=>{O(!0)},8e3);try{await l(s)}catch(t){const e=t instanceof Error?t.message:"שגיאה בניחוש המילה";e.includes("not found")||e.includes("לא נמצא")?u(`אני לא מכיר את המילה ${s}`):u(e)}finally{B.current&&(clearTimeout(B.current),B.current=null),O(!1),S.current=!1,C(!1)}},className:"flex flex-row gap-2",autoComplete:"off",style:{minHeight:"50px"},children:[e.jsx("input",{ref:P,type:"search",value:o,onChange:e=>m(e.target.value),onBlur:z,placeholder:"נחש מילה...",disabled:!1,dir:"rtl",autoComplete:"off",autoCorrect:"on",autoCapitalize:"none",inputMode:"text",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 text-lg"}),e.jsx(t,{type:"submit",className:"bg-primary-500 hover:bg-primary-600 dark:bg-primary-700 dark:hover:bg-primary-600 px-4 py-2 text-sm font-medium whitespace-nowrap flex items-center justify-center min-w-[70px] h-10",disabled:!o.trim(),onMouseDown:e=>{e.preventDefault()},onTouchStart:e=>{e.preventDefault()},children:g?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):"נחש"})]}),x&&e.jsx(_,{variant:"destructive",children:e.jsx(D,{children:x})})]})]}),J&&!r.isComplete&&e.jsxs("div",{className:"space-y-2",ref:V,children:[e.jsx("h3",{className:"text-lg font-bold font-heebo",children:"הניחוש האחרון"}),e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(w,{className:"border-b",children:[e.jsx(v,{className:"text-right w-12 py-2 px-2",children:"#"}),e.jsx(v,{className:"text-right w-24 py-2 px-2",children:"מילה"}),e.jsx(v,{className:"text-center w-20 py-2 px-2",children:"קרבה"}),e.jsx(v,{className:"text-center w-28 py-2 px-2",children:"מתחמם?"})]})}),e.jsx(N,{children:e.jsxs(w,{className:"bg-primary-100 dark:bg-primary-900/30 border-primary-200 dark:border-primary-700",children:[e.jsx(k,{className:"w-12 py-1 px-2 text-xs font-medium text-primary-700 dark:text-primary-300",children:r.guesses.length}),e.jsx(k,{className:"w-24 font-medium py-1 px-2 text-xs truncate text-primary-700 dark:text-primary-300",children:J.word}),e.jsx(k,{className:"w-20 text-center py-1 px-2 text-xs text-primary-700 dark:text-primary-300",children:`${(100*J.similarity).toFixed(2)}%`}),e.jsx(k,{className:"w-28 text-center py-1 px-2",children:J.rank&&J.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm min-w-[2px]",style:{width:R(J.rank)}})}),e.jsxs("span",{className:"text-xs text-primary-700 dark:text-primary-300 font-heebo whitespace-nowrap",children:[J.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-primary-700 dark:text-primary-300 font-heebo",children:"רחוק"})})]})})]})})]}),K.length>0&&e.jsx("div",{className:J&&!r.isComplete?"mt-1":"space-y-2",children:e.jsx(E,{guesses:K,originalGuesses:r.guesses,showHeader:!J||r.isComplete})}),0===r.guesses.length&&!r.isComplete&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"עדיין אין ניחושים. התחל לנחש!"})]})});T.displayName="GameBoard";const L=({isOpen:r,onClose:t})=>{const[d,c]=s.useState(!0),x=()=>{c(!d)};return e.jsx(a,{open:r,onOpenChange:t,children:e.jsxs(l,{className:"sm:max-w-md",children:[e.jsx(n,{children:e.jsx(i,{className:"text-center",children:d?"התחברות":"הרשמה"})}),e.jsx("div",{className:"space-y-4",children:d?e.jsx(o,{onToggleMode:x}):e.jsx(m,{onToggleMode:x})})]})})},F=()=>{const{isLoading:r}=h(),{isLoading:t}=g(),[a,l]=s.useState(!1),[n,i]=s.useState(!1);return s.useEffect(()=>{l(!0)},[]),!a||t?e.jsx(C,{children:e.jsx("div",{className:"flex flex-col justify-center items-center h-64",children:e.jsx("div",{className:"text-xl text-primary-500 dark:text-primary-400 mb-4",children:"טוען..."})})}):e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[r?e.jsx("div",{className:"flex flex-col justify-center items-center h-64",children:e.jsx("div",{className:"text-xl text-primary-500 dark:text-primary-400 mb-4",children:"טוען משחק..."})}):e.jsx(T,{}),e.jsx(L,{isOpen:n,onClose:()=>i(!1)})]})})};export{F as default};
