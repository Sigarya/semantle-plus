import{j as e}from"./ui.DDQN6UUz.js";import{r}from"./vendor.CJDJhWJD.js";import{u as t,g as a,h as s,j as o,I as i,B as d,i as l,s as n,f as c}from"./index.DxnqBTDv.js";import{C as g,b as x,c as h,a as m,P as w}from"./PageLayout.CG6p3OLK.js";import{T as j,a as y,b as u,c as b,d as v,e as p}from"./table.BlejdXgt.js";import"./utils.CIxrdROE.js";const f=()=>{const{dailyWords:c,setWordForDate:w}=t(),{toast:f}=a();s();const[k,N]=r.useState(""),[S,D]=r.useState((new Date).toISOString().split("T")[0]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs(g,{className:"bg-white dark:bg-slate-800 border-gray-200 dark:border-slate-700",children:[e.jsx(x,{children:e.jsx(h,{className:"text-xl text-gray-900 dark:text-white",children:"הגדר מילה חדשה"})}),e.jsx(m,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),k.trim())try{const e=new Date(S+"T12:00:00"),r=`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`,{data:t,error:a}=await n.functions.invoke("set-daily-word",{body:{date:r,word:k.trim()}});if(a)throw console.error("Error calling edge function:",a),new Error("שגיאה בקשת השרת");if(t?.error)throw console.error("Server error:",t.error),new Error(t.error);await w(k,S),f({title:"הצלחה",description:`המילה "${k}" נקבעה לתאריך ${l(new Date(S))} בשני השרתים`}),N("")}catch(r){f({variant:"destructive",title:"שגיאה",description:r instanceof Error?r.message:"אירעה שגיאה בהגדרת המילה"})}else f({variant:"destructive",title:"שגיאה",description:"אנא הכנס מילה"})},className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"date",className:"text-gray-700 dark:text-gray-300",children:"תאריך"}),e.jsx(i,{id:"date",type:"date",value:S,onChange:e=>D(e.target.value),className:"rtl:text-right bg-white dark:bg-slate-700 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(o,{htmlFor:"word",className:"text-gray-700 dark:text-gray-300",children:"מילה"}),e.jsx(i,{id:"word",value:k,onChange:e=>N(e.target.value),placeholder:"הכנס מילה חדשה...",dir:"rtl",className:"bg-white dark:bg-slate-700 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-white"})]}),e.jsx(d,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"שמור מילה"})]})})]}),e.jsxs(g,{className:"bg-white dark:bg-slate-800 border-gray-200 dark:border-slate-700",children:[e.jsx(x,{children:e.jsx(h,{className:"text-xl text-gray-900 dark:text-white",children:"מילים מוגדרות"})}),e.jsx(m,{children:e.jsxs(j,{children:[e.jsx(y,{children:e.jsxs(u,{children:[e.jsx(b,{className:"text-right text-gray-700 dark:text-gray-300",children:"תאריך"}),e.jsx(b,{className:"text-right text-gray-700 dark:text-gray-300",children:"מילה"}),e.jsx(b,{className:"text-right text-gray-700 dark:text-gray-300",children:"פעולות"})]})}),e.jsx(v,{children:c.sort((e,r)=>new Date(r.date).getTime()-new Date(e.date).getTime()).map(r=>e.jsxs(u,{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e.jsx(p,{className:"text-gray-900 dark:text-white",children:l(new Date(r.date))}),e.jsx(p,{className:"text-gray-900 dark:text-white",children:r.word}),e.jsx(p,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{N(r.word),D(r.date)},className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-600",children:"ערוך"}),e.jsx(d,{variant:"default",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:e=>{e.preventDefault(),e.stopPropagation(),(async(e,r)=>{try{console.log("Setting word on server:",{word:e,date:r});const t=new Date(r+"T12:00:00"),a=`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`;console.log("Formatted date:",a),console.log("Calling edge function set-daily-word...");const{data:s,error:o}=await n.functions.invoke("set-daily-word",{body:{date:a,word:e.trim()}});if(console.log("Edge function response:",{data:s,error:o}),o)throw console.error("Error calling edge function:",o),new Error(`שגיאה בקשת השרת: ${o.message||o}`);if(s?.error)throw console.error("Server error:",s.error),new Error(s.error);f({title:"הצלחה",description:`המילה "${e}" נקבעה בהצלחה בשרת החיצוני לתאריך ${l(t)}`})}catch(t){console.error("Full error in handleSetWordOnServer:",t),f({variant:"destructive",title:"שגיאה",description:t instanceof Error?t.message:"אירעה שגיאה בהגדרת המילה בשרת החיצוני"})}})(r.word,r.date)},children:"הגדר"})]})})]},r.date))})]})})]})]})},k=()=>{const{currentUser:t}=c(),o=s(),{toast:i}=a();return r.useEffect(()=>{t?.isAdmin||(i({variant:"destructive",title:"גישה נדחתה",description:"אין לך הרשאה לצפות בדף זה"}),o("/"))},[t,o,i]),t?.isAdmin?e.jsx(w,{title:"פאנל ניהול",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsx(f,{})})}):null};export{k as default};
