import{j as e}from"./ui.DDQN6UUz.js";import{r as s}from"./vendor.CJDJhWJD.js";import{f as r,s as t,u as a,g as i,h as n,i as d,B as o,L as l}from"./index.DNTnC8Xv.js";import{C as c,b as m,c as x,a as h,P as p}from"./PageLayout.DUHnw4gy.js";import{T as j,a as g,b as u,c as f,d as b,e as y}from"./table.E0_fjeSZ.js";import{U as w}from"./users.DiJrpnrC.js";import"./utils.CIxrdROE.js";const N=()=>{const{dailyWords:p,loadHistoricalGame:N}=a(),{isGameCompleted:k}=(()=>{const{currentUser:e}=r(),[a,i]=s.useState([]),[n,d]=s.useState(!1),o=async()=>{if(e){d(!0);try{const{data:s,error:r}=await t.from("daily_scores").select("word_date, guesses_count, completion_time").eq("user_id",e.id).order("word_date",{ascending:!1});r?(console.error("Error fetching user completions:",r),i([])):i(s||[])}catch(s){console.error("Error fetching user completions:",s),i([])}finally{d(!1)}}else i([])};return s.useEffect(()=>{o()},[e]),{completions:a,isLoading:n,isGameCompleted:e=>a.some(s=>s.word_date===e),getCompletionInfo:e=>a.find(s=>s.word_date===e)||null,refreshCompletions:o}})(),{toast:v}=i(),_=n(),[S,C]=s.useState(!1),D=[...p].sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime());return e.jsxs(c,{className:"bg-background dark:bg-slate-800 border-primary-200 dark:border-slate-700",children:[e.jsx(m,{children:e.jsx(x,{className:"text-xl font-heebo",children:"היסטורית משחקים"})}),e.jsx(h,{children:0===D.length?e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:"אין משחקים קודמים זמינים כרגע"}):e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs(u,{children:[e.jsx(f,{className:"text-right",children:"תאריך"}),e.jsx(f,{className:"text-center",children:"פעולות"})]})}),e.jsx(b,{children:D.map(s=>{const r=new Date(s.date),t=new Date;t.setHours(0,0,0,0);const a=r<t,i=k(s.date);return e.jsxs(u,{children:[e.jsx(y,{children:d(new Date(s.date))}),e.jsx(y,{className:"text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[a&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>(async e=>{C(!0);try{await N(e),_("/"),v({title:"משחק היסטורי נטען",description:`המשחק מתאריך ${d(new Date(e))} נטען בהצלחה`})}catch(s){v({variant:"destructive",title:"שגיאה",description:s instanceof Error?s.message:"אירעה שגיאה בטעינת המשחק"})}finally{C(!1)}})(s.date),disabled:S,className:"min-w-[80px] "+(i?"border-green-500 text-green-600 hover:bg-green-50 dark:text-green-400 dark:border-green-400 dark:hover:bg-green-900/20":""),children:S?"טוען...":i?"הושלם 🎉":"שחק"}),e.jsx(l,{to:`/multiplayer?date=${s.date}`,children:e.jsxs(o,{variant:"ghost",size:"sm",className:"gap-1 min-w-[100px]",children:[e.jsx(w,{className:"w-4 h-4"}),"עם חברים"]})})]}),!a&&s.date===t.toISOString().split("T")[0]&&e.jsx("span",{className:"text-primary-600 dark:text-primary-400",children:"משחק נוכחי"}),!a&&s.date!==t.toISOString().split("T")[0]&&e.jsx("span",{className:"text-muted-foreground",children:"טרם זמין"})]})})]},s.date)})})]})})]})},k=()=>e.jsxs(p,{title:"היסטורית משחקים",children:[e.jsx("div",{className:"max-w-3xl mx-auto mb-6 p-4 bg-primary-50 dark:bg-slate-800 rounded-md border border-primary-200 dark:border-slate-700 text-center",children:e.jsxs("p",{className:"text-primary-800 dark:text-primary-300",children:["רוצים לנסות שוב? פספסתם את הסמנטעל אתמול? כאן תוכלו לשחק בגרסאות קודמות של המשחק היומי.",e.jsx("br",{}),"בכל יום, קצת אחרי שעולה החידה החדשה בסמנטעל, יעלה המשחק של אתמול ותוכלו למצוא אותו גם כאן וגם בדף הראשי."]})}),e.jsx(N,{})]});export{k as default};
