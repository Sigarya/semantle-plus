import{j as e}from"./ui.DDQN6UUz.js";import{r}from"./vendor.CJDJhWJD.js";import{C as t,b as a,c as s,a as o,H as d}from"./Header.DKD4Nm_c.js";import{u as i,g as l,h as n,j as c,I as g,B as x,i as h,s as m,f as j}from"./index.B8S3QjmP.js";import{T as w,a as b,b as y,c as u,d as p,e as v}from"./table.CbebjMa5.js";import"./utils.CIxrdROE.js";const f=()=>{const{dailyWords:d,setWordForDate:j}=i(),{toast:f}=l();n();const[k,N]=r.useState(""),[S,D]=r.useState((new Date).toISOString().split("T")[0]);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs(t,{className:"bg-white dark:bg-slate-800 border-gray-200 dark:border-slate-700",children:[e.jsx(a,{children:e.jsx(s,{className:"text-xl text-gray-900 dark:text-white",children:"הגדר מילה חדשה"})}),e.jsx(o,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),k.trim())try{const e=new Date(S+"T12:00:00"),r=`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`,{data:t,error:a}=await m.functions.invoke("set-daily-word",{body:{date:r,word:k.trim()}});if(a)throw console.error("Error calling edge function:",a),new Error("שגיאה בקשת השרת");if(t?.error)throw console.error("Server error:",t.error),new Error(t.error);await j(k,S),f({title:"הצלחה",description:`המילה "${k}" נקבעה לתאריך ${h(new Date(S))} בשני השרתים`}),N("")}catch(r){f({variant:"destructive",title:"שגיאה",description:r instanceof Error?r.message:"אירעה שגיאה בהגדרת המילה"})}else f({variant:"destructive",title:"שגיאה",description:"אנא הכנס מילה"})},className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"date",className:"text-gray-700 dark:text-gray-300",children:"תאריך"}),e.jsx(g,{id:"date",type:"date",value:S,onChange:e=>D(e.target.value),className:"rtl:text-right bg-white dark:bg-slate-700 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-white"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(c,{htmlFor:"word",className:"text-gray-700 dark:text-gray-300",children:"מילה"}),e.jsx(g,{id:"word",value:k,onChange:e=>N(e.target.value),placeholder:"הכנס מילה חדשה...",dir:"rtl",className:"bg-white dark:bg-slate-700 border-gray-300 dark:border-slate-600 text-gray-900 dark:text-white"})]}),e.jsx(x,{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"שמור מילה"})]})})]}),e.jsxs(t,{className:"bg-white dark:bg-slate-800 border-gray-200 dark:border-slate-700",children:[e.jsx(a,{children:e.jsx(s,{className:"text-xl text-gray-900 dark:text-white",children:"מילים מוגדרות"})}),e.jsx(o,{children:e.jsxs(w,{children:[e.jsx(b,{children:e.jsxs(y,{children:[e.jsx(u,{className:"text-right text-gray-700 dark:text-gray-300",children:"תאריך"}),e.jsx(u,{className:"text-right text-gray-700 dark:text-gray-300",children:"מילה"}),e.jsx(u,{className:"text-right text-gray-700 dark:text-gray-300",children:"פעולות"})]})}),e.jsx(p,{children:d.sort((e,r)=>new Date(r.date).getTime()-new Date(e.date).getTime()).map(r=>e.jsxs(y,{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e.jsx(v,{className:"text-gray-900 dark:text-white",children:h(new Date(r.date))}),e.jsx(v,{className:"text-gray-900 dark:text-white",children:r.word}),e.jsx(v,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>{N(r.word),D(r.date)},className:"border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-slate-600",children:"ערוך"}),e.jsx(x,{variant:"default",size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:e=>{e.preventDefault(),e.stopPropagation(),(async(e,r)=>{try{console.log("Setting word on server:",{word:e,date:r});const t=new Date(r+"T12:00:00"),a=`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`;console.log("Formatted date:",a),console.log("Calling edge function set-daily-word...");const{data:s,error:o}=await m.functions.invoke("set-daily-word",{body:{date:a,word:e.trim()}});if(console.log("Edge function response:",{data:s,error:o}),o)throw console.error("Error calling edge function:",o),new Error(`שגיאה בקשת השרת: ${o.message||o}`);if(s?.error)throw console.error("Server error:",s.error),new Error(s.error);f({title:"הצלחה",description:`המילה "${e}" נקבעה בהצלחה בשרת החיצוני לתאריך ${h(t)}`})}catch(t){console.error("Full error in handleSetWordOnServer:",t),f({variant:"destructive",title:"שגיאה",description:t instanceof Error?t.message:"אירעה שגיאה בהגדרת המילה בשרת החיצוני"})}})(r.word,r.date)},children:"הגדר"})]})})]},r.date))})]})})]})]})},k=()=>{const{currentUser:t}=j(),a=n(),{toast:s}=l();return r.useEffect(()=>{t?.isAdmin||(s({variant:"destructive",title:"גישה נדחתה",description:"אין לך הרשאה לצפות בדף זה"}),a("/"))},[t,a,s]),t?.isAdmin?e.jsxs("div",{className:"min-h-screen flex flex-col bg-background dark:bg-slate-900",children:[e.jsx(d,{}),e.jsx("main",{className:"flex-grow p-4 md:p-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx("h2",{className:"text-3xl font-bold text-center text-primary-600 dark:text-primary-400 mb-8 font-heebo",children:"פאנל ניהול"}),e.jsx(f,{})]})}),e.jsxs("footer",{className:"p-4 border-t border-primary-200 dark:border-slate-700 text-center text-sm text-muted-foreground",children:["סמנטעל + © ",(new Date).getFullYear()]})]}):null};export{k as default};
