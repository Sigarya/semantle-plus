import{j as e}from"./ui.DDQN6UUz.js";import{r as s}from"./vendor.CJDJhWJD.js";import{k as t,g as a,B as r,j as n,I as c,c as i,a as l,l as o,m as d,h as m,u as x}from"./index.Dq_p6mnX.js";import{C as h,b as u,c as j,a as p,P as g}from"./PageLayout.DawDw_ct.js";import{U as y}from"./users.BeghQ34r.js";import{T as f,a as N,b as v,c as b,d as k,e as w}from"./table.CggEqzpr.js";import"./utils.CIxrdROE.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=t("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),M=t("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),L=t("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),S=t("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),D=t("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),R=t("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),_=t("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),F=({onCreateRoom:t,onJoinRoom:i,wordDate:l,isLoading:o})=>{const{toast:d}=a(),[m,x]=s.useState("lobby"),[g,f]=s.useState(""),[N,v]=s.useState(""),b=new Date(l).toLocaleDateString("he-IL");return e.jsxs("div",{className:"space-y-4 max-w-2xl mx-auto",children:["lobby"===m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold font-heebo mb-2",children:"שחק עם חברים"}),e.jsxs("p",{className:"text-muted-foreground",children:["משחק מיום ",b]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"אין צורך בהרשמה - פשוט הכנס שם ותתחיל לשחק!"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(h,{className:"cursor-pointer transition-all hover:shadow-lg hover:scale-105",onClick:()=>x("create"),children:[e.jsxs(u,{className:"text-center",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-2 text-primary-500"}),e.jsx(j,{className:"font-heebo",children:"צור חדר חדש"})]}),e.jsxs(p,{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"צור חדר חדש ושתף את הקוד עם החברים שלך"}),e.jsxs(r,{className:"w-full",children:["צור חדר",e.jsx(C,{className:"w-4 h-4 mr-2"})]})]})]}),e.jsxs(h,{className:"cursor-pointer transition-all hover:shadow-lg hover:scale-105",onClick:()=>x("join"),children:[e.jsxs(u,{className:"text-center",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-2 text-primary-500"}),e.jsx(j,{className:"font-heebo",children:"הצטרף לחדר קיים"})]}),e.jsxs(p,{className:"text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"הזן קוד חדר שקיבלת מחבר והצטרף למשחק"}),e.jsxs(r,{variant:"outline",className:"w-full",children:["הצטרף לחדר",e.jsx(_,{className:"w-4 h-4 mr-2"})]})]})]})]})]}),"create"===m&&e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(j,{className:"font-heebo text-center",children:"צור חדר חדש"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"nickname",children:"השם שלך במשחק"}),e.jsx(c,{id:"nickname",value:g,onChange:e=>f(e.target.value),placeholder:"הכנס שם לתצוגה...",maxLength:20,dir:"rtl"})]}),e.jsx("div",{className:"bg-muted p-4 rounded-md",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"לאחר יצירת החדר תקבל קוד חדר ייחודי שתוכל לשתף עם החברים שלך. כל השחקנים יראו את הניחושים של כולם בזמן אמת!"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{onClick:()=>{g.trim()?t(g.trim()):d({title:"שם חסר",description:"יש להכניס שם לתצוגה במשחק",variant:"destructive"})},disabled:o||!g.trim(),className:"flex-1",children:o?"יוצר חדר...":"צור חדר"}),e.jsx(r,{variant:"outline",onClick:()=>x("lobby"),disabled:o,children:"חזור"})]})]})]}),"join"===m&&e.jsxs(h,{children:[e.jsx(u,{children:e.jsx(j,{className:"font-heebo text-center",children:"הצטרף לחדר קיים"})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"room-code",children:"קוד החדר"}),e.jsx(c,{id:"room-code",value:N,onChange:e=>v(e.target.value.toUpperCase()),placeholder:"הכנס קוד חדר (למשל: ABC123)",maxLength:6,className:"text-center font-mono text-lg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"join-nickname",children:"השם שלך במשחק"}),e.jsx(c,{id:"join-nickname",value:g,onChange:e=>f(e.target.value),placeholder:"הכנס שם לתצוגה...",maxLength:20,dir:"rtl"})]}),e.jsx("div",{className:"bg-muted p-4 rounded-md",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"הזן את קוד החדר שקיבלת מהחבר שיצר את החדר ואת השם שברצונך שיופיע במשחק."})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{onClick:()=>{g.trim()?N.trim()?i(N.trim().toUpperCase(),g.trim()):d({title:"קוד חדר חסר",description:"יש להכניס קוד חדר תקין",variant:"destructive"}):d({title:"שם חסר",description:"יש להכניס שם לתצוגה במשחק",variant:"destructive"})},disabled:o||!g.trim()||!N.trim(),className:"flex-1",children:o?"מצטרף...":"הצטרף לחדר"}),e.jsx(r,{variant:"outline",onClick:()=>x("lobby"),disabled:o,children:"חזור"})]})]})]})]})},T=l("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function E({className:s,variant:t,...a}){return e.jsx("div",{className:i(T({variant:t}),s),...a})}const H=e=>{if(!e||e<=0)return"0%";return`${Math.min(e/1e3*100,100)}%`},V=()=>{const{gameState:t,makeGuess:n,leaveRoom:i}=o(),{toast:l}=a(),[d,m]=s.useState(""),[x,g]=s.useState(!1),[C,_]=s.useState(!1),F=s.useMemo(()=>[...t.guesses].sort((e,s)=>s.similarity-e.similarity),[t.guesses]),T=s.useCallback(async()=>{const e=t.room?.room_code||"";if(e)try{if(navigator.clipboard&&"function"==typeof navigator.clipboard.writeText)await navigator.clipboard.writeText(e);else{const s=document.createElement("textarea");s.value=e,s.setAttribute("readonly",""),s.style.position="absolute",s.style.left="-9999px",document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s)}_(!0),setTimeout(()=>_(!1),2e3)}catch(s){console.error("Failed to copy room code:",s),window.prompt("Could not copy automatically. Please copy this code:",e)}},[t.room?.room_code]),V=s.useCallback(async e=>{if(e.preventDefault(),d.trim()&&!x){g(!0);try{await n(d.trim()),m("")}catch(s){const e=s instanceof Error?s.message:"שגיאה בניחוש המילה";l({title:"שגיאה",description:e,variant:"destructive"})}finally{g(!1)}}},[d,x,n,l]);return t.room?e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsx(h,{children:e.jsxs(u,{className:"text-center",children:[e.jsxs(j,{className:"flex items-center justify-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"חדר מרובה משתתפים"]}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["קוד חדר:",e.jsxs("button",{onClick:T,className:"inline-flex items-center gap-1 ml-1 hover:bg-muted px-2 py-1 rounded transition-colors",title:"לחץ להעתקה",children:[e.jsx(E,{variant:"secondary",className:"cursor-pointer hover:bg-muted-foreground/20",children:t.room.room_code}),C?e.jsx(M,{className:"h-3 w-3 text-green-500"}):e.jsx(L,{className:"h-3 w-3"})]})]}),e.jsxs("span",{children:["תאריך: ",new Date(t.room.word_date).toLocaleDateString("he-IL")]}),e.jsxs("span",{children:["שחקנים: ",t.players.length]})]})]})}),e.jsxs(h,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"})," הכנס ניחוש"]})}),e.jsx(p,{children:e.jsxs("form",{onSubmit:V,className:"flex gap-2",children:[e.jsx(c,{value:d,onChange:e=>m(e.target.value),placeholder:"הקלד מילה...",disabled:x||t.isComplete,className:"flex-1"}),e.jsx(r,{type:"submit",disabled:x||t.isComplete||!d.trim(),className:"min-w-[100px]",children:x?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 animate-spin mr-2"})," שולח..."]}):"שלח"})]})})]}),e.jsxs(h,{children:[e.jsx(u,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"})," ניחושים (",t.guesses.length,")"]})}),e.jsx(p,{children:0===t.guesses.length?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"עדיין אין ניחושים. תהיה הראשון!"}):e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs(f,{children:[e.jsx(N,{children:e.jsxs(v,{children:[e.jsx(b,{className:"text-right",children:"#"}),e.jsx(b,{className:"text-right",children:"מילה"}),e.jsx(b,{className:"text-right",children:"שחקן"}),e.jsx(b,{className:"text-center",children:"קרבה"}),e.jsx(b,{className:"text-center",children:"מתחמם?"})]})}),e.jsx(k,{children:F.map(s=>e.jsxs(v,{className:s.is_correct?"bg-green-500/20":"",children:[e.jsx(w,{className:"text-right",children:s.guess_order}),e.jsx(w,{className:"font-medium text-right",children:s.guess_word}),e.jsx(w,{className:"text-right",children:e.jsx(E,{variant:"outline",children:s.player_nickname})}),e.jsx(w,{className:"text-center",children:`${(100*s.similarity).toFixed(2)}%`}),e.jsx(w,{className:"text-center",children:s.rank&&s.rank>0?e.jsxs("div",{className:"flex items-center gap-1 justify-center",children:[e.jsx("div",{className:"relative w-16 h-3 bg-muted rounded-sm flex-shrink-0",children:e.jsx("div",{className:"absolute top-0 left-0 h-full bg-green-500 rounded-sm transition-all duration-200 min-w-[2px]",style:{width:H(s.rank)}})}),e.jsxs("span",{className:"text-xs text-muted-foreground font-heebo whitespace-nowrap",children:[s.rank,"/1000"]})]}):e.jsx("span",{className:"text-xs text-muted-foreground font-heebo",children:"רחוק"})})]},s.id))})]})})})]}),t.isComplete&&e.jsxs(h,{className:"border-green-200 bg-green-50",children:[e.jsx(u,{className:"text-center",children:e.jsxs(j,{className:"text-green-800 flex items-center justify-center gap-2",children:[e.jsx(R,{className:"h-6 w-6"})," המשחק הסתיים!"]})}),e.jsxs(p,{className:"text-center",children:[e.jsx("p",{className:"text-green-700 mb-4",children:"מישהו ניחש את המילה הנכונה! המשחק הסתיים."}),e.jsx(r,{onClick:i,variant:"outline",children:"עזוב חדר"})]})]}),!t.isComplete&&e.jsx("div",{className:"text-center",children:e.jsx(r,{onClick:i,variant:"outline",children:"עזוב חדר"})})]}):e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"טוען משחק מרובה משתתפים..."})]})})},q=()=>{const[t]=d();m();const{toast:r}=a(),{gameState:n,isLoading:c,createRoom:i,joinRoom:l}=o(),{getCurrentGameDate:h}=x(),[u,j]=s.useState("");s.useEffect(()=>{const e=t.get("date");j(e||h())},[t,h]);return e.jsx(g,{children:e.jsx("div",{className:"space-y-6",children:n.room?e.jsx(V,{}):e.jsx(F,{onCreateRoom:async e=>{try{const s=await i(e,u);r({title:"חדר נוצר בהצלחה! 🎉",description:`קוד החדר: ${s}`,duration:5e3})}catch(s){console.error("Error creating room:",s)}},onJoinRoom:async(e,s)=>{try{await l(e,s),r({title:"הצטרפת לחדר! 🎉",description:"המשחק הקבוצתי מתחיל",duration:3e3})}catch(t){console.error("Error joining room:",t)}},wordDate:u,isLoading:c})})})};export{q as default};
